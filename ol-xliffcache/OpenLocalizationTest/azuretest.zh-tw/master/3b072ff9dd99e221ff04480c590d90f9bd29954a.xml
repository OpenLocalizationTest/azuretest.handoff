<markdown_skeleton_root>
  <block_element>
    <ArrayOfMarkdownBlockBase xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <MarkdownBlockBase
        xsi:type="MarkdownAzureMetadataBlock"
        item_id="8a94511b-5eeb-4437-b11c-76ae6a3fc86e"
        item_type="AzureMetadata"
        item_footer="footer_not_set"
        trans_unit_id="8a94511b-5eeb-4437-b11c-76ae6a3fc86e">
        <LocalizeItemList>
          <MarkdownInternalXmlItem
            internal_item_id="c2e5483d-2933-47c5-af45-2fb59027697f"
            trans_unit_id="101"
            internal_item_type="Xml">
            <internal_items />
          </MarkdownInternalXmlItem>
          <MarkdownInternalXmlItem
            internal_item_id="e4e83f8a-fe13-4b8c-b872-c74e6b0c8b80"
            trans_unit_id="102"
            internal_item_type="Xml">
            <internal_items />
          </MarkdownInternalXmlItem>
        </LocalizeItemList>
        <ItemValue>&lt;properties
   pageTitle="c2e5483d-2933-47c5-af45-2fb59027697f"
   description="e4e83f8a-fe13-4b8c-b872-c74e6b0c8b80"
   services="service-fabric"
   documentationCenter=".net"
   authors="anmolah"
   manager="timlt"
   editor=""/&gt;

&lt;tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="08/05/2015"
   ms.author="anmola"/&gt;

</ItemValue>
      </MarkdownBlockBase>
      <MarkdownBlockBase
        xsi:type="MarkdownHeaderBlock"
        item_id="4378b316-2a26-4a50-bf66-ed6b87e05243"
        item_type="Header"
        item_footer="footer_not_set"
        trans_unit_id="4378b316-2a26-4a50-bf66-ed6b87e05243">
        <segment
          trans_unit_id="103">
          <SegmentId>e41eaea1-3c1c-41ba-8149-f8c2bfe98c28</SegmentId>
          <InternalNormalItem
            internal_item_id="1"
            internal_item_parent_id="103"
            trans_unit_id="103-1"
            internal_item_type="Normal">
            <internal_items />
          </InternalNormalItem>
        </segment>
        <header_type>Star</header_type>
        <header_level>1</header_level>
      </MarkdownBlockBase>
      <MarkdownBlockBase
        xsi:type="MarkdownParagraphBlock"
        item_id="2b5c43a1-8ca2-4cb5-90f1-58e3c8edfa67"
        item_type="NormalParagraph"
        item_footer=""
        trans_unit_id="2b5c43a1-8ca2-4cb5-90f1-58e3c8edfa67">
        <Lines>
          <MarkdownLine>
            <LineId>5dfe6284-f002-464b-a8c2-50a5ff864464</LineId>
            <paragraph_segments>
              <MarkdownSegment
                trans_unit_id="104">
                <SegmentId>f8f0ecf1-8610-4f0a-82dc-2e42586a993e</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="104"
                  trans_unit_id="104-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
              <MarkdownSegment
                trans_unit_id="105">
                <SegmentId>ffd7b044-1bc3-4db0-b94f-4a9dee7c204e</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="105"
                  trans_unit_id="105-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
              <MarkdownSegment
                trans_unit_id="106">
                <SegmentId>0b037068-b32f-4484-9601-dd3b3e5c1064</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="106"
                  trans_unit_id="106-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
              <MarkdownSegment
                trans_unit_id="107">
                <SegmentId>2b3491bd-839e-4d40-bd6b-beba6415d7e3</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="107"
                  trans_unit_id="107-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
              <MarkdownSegment
                trans_unit_id="108">
                <SegmentId>5740fbd5-b563-4fda-8566-c4c4ee14d30c</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="108"
                  trans_unit_id="108-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
            </paragraph_segments>
            <PrefixWSLength>0</PrefixWSLength>
            <SuffixWSLength>0</SuffixWSLength>
          </MarkdownLine>
        </Lines>
        <paragraph_segments>
          <MarkdownSegment
            trans_unit_id="104">
            <SegmentId>f8f0ecf1-8610-4f0a-82dc-2e42586a993e</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="104"
              trans_unit_id="104-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
          <MarkdownSegment
            trans_unit_id="105">
            <SegmentId>ffd7b044-1bc3-4db0-b94f-4a9dee7c204e</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="105"
              trans_unit_id="105-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
          <MarkdownSegment
            trans_unit_id="106">
            <SegmentId>0b037068-b32f-4484-9601-dd3b3e5c1064</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="106"
              trans_unit_id="106-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
          <MarkdownSegment
            trans_unit_id="107">
            <SegmentId>2b3491bd-839e-4d40-bd6b-beba6415d7e3</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="107"
              trans_unit_id="107-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
          <MarkdownSegment
            trans_unit_id="108">
            <SegmentId>5740fbd5-b563-4fda-8566-c4c4ee14d30c</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="108"
              trans_unit_id="108-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
        </paragraph_segments>
      </MarkdownBlockBase>
      <MarkdownBlockBase
        xsi:type="MarkdownHeaderBlock"
        item_id="78f50112-e2fc-42fc-9586-eb5aa556d582"
        item_type="Header"
        item_footer="footer_not_set"
        trans_unit_id="78f50112-e2fc-42fc-9586-eb5aa556d582">
        <segment
          trans_unit_id="109">
          <SegmentId>9a095c9a-b218-4c4d-b707-2eabf040db12</SegmentId>
          <InternalNormalItem
            internal_item_id="1"
            internal_item_parent_id="109"
            trans_unit_id="109-1"
            internal_item_type="Normal">
            <internal_items />
          </InternalNormalItem>
        </segment>
        <header_type>Star</header_type>
        <header_level>2</header_level>
      </MarkdownBlockBase>
      <MarkdownBlockBase
        xsi:type="MarkdownParagraphBlock"
        item_id="4077c19d-7f21-436f-9374-3f7ce02e94ff"
        item_type="NormalParagraph"
        item_footer=""
        trans_unit_id="4077c19d-7f21-436f-9374-3f7ce02e94ff">
        <Lines>
          <MarkdownLine>
            <LineId>a1b0a3ad-f155-4bcd-99eb-f67237838444</LineId>
            <paragraph_segments>
              <MarkdownSegment
                trans_unit_id="110">
                <SegmentId>9024cef4-4dbe-47c8-9c02-f5d57a4fcf51</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="110"
                  trans_unit_id="110-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
                <LinkItem
                  internal_item_id="2"
                  internal_item_parent_id="110"
                  trans_unit_id="110-2"
                  internal_item_type="Link">
                  <internal_items />
                  <internal_link_type>Inline</internal_link_type>
                  <internal_link_text>graceful and ungraceful failures</internal_link_text>
                  <internal_link_url>service-fabric-testability-actions.md#graceful-vs-ungraceful-fault-actions</internal_link_url>
                  <internal_link_title />
                </LinkItem>
                <InternalNormalItem
                  internal_item_id="3"
                  internal_item_parent_id="110"
                  trans_unit_id="110-3"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
              <MarkdownSegment
                trans_unit_id="111">
                <SegmentId>b5140f4f-2e2f-4379-9d7b-94116a071cb2</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="111"
                  trans_unit_id="111-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
            </paragraph_segments>
            <PrefixWSLength>0</PrefixWSLength>
            <SuffixWSLength>0</SuffixWSLength>
          </MarkdownLine>
        </Lines>
        <paragraph_segments>
          <MarkdownSegment
            trans_unit_id="110">
            <SegmentId>9024cef4-4dbe-47c8-9c02-f5d57a4fcf51</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="110"
              trans_unit_id="110-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
            <LinkItem
              internal_item_id="2"
              internal_item_parent_id="110"
              trans_unit_id="110-2"
              internal_item_type="Link">
              <internal_items />
              <internal_link_type>Inline</internal_link_type>
              <internal_link_text>graceful and ungraceful failures</internal_link_text>
              <internal_link_url>service-fabric-testability-actions.md#graceful-vs-ungraceful-fault-actions</internal_link_url>
              <internal_link_title />
            </LinkItem>
            <InternalNormalItem
              internal_item_id="3"
              internal_item_parent_id="110"
              trans_unit_id="110-3"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
          <MarkdownSegment
            trans_unit_id="111">
            <SegmentId>b5140f4f-2e2f-4379-9d7b-94116a071cb2</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="111"
              trans_unit_id="111-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
        </paragraph_segments>
      </MarkdownBlockBase>
      <MarkdownBlockBase
        xsi:type="MarkdownParagraphBlock"
        item_id="e935d176-3c13-4d01-9ab0-b3059a69f499"
        item_type="NormalParagraph"
        item_footer="footer_not_set"
        trans_unit_id="e935d176-3c13-4d01-9ab0-b3059a69f499">
        <Lines>
          <MarkdownLine>
            <LineId>fd00eb18-7a2a-416e-b100-e4f0de09da00</LineId>
            <paragraph_segments>
              <MarkdownSegment
                trans_unit_id="112">
                <SegmentId>e497ddb9-a11a-4cbe-ac79-13fab7052c4b</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="112"
                  trans_unit_id="112-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
              <MarkdownSegment
                trans_unit_id="113">
                <SegmentId>2bd89a57-99e4-4ab3-b4c7-d9ec84d200c3</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="113"
                  trans_unit_id="113-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
              <MarkdownSegment
                trans_unit_id="114">
                <SegmentId>b8f311a9-c8bf-41e3-96ce-74cb1679e01c</SegmentId>
                <InternalNormalItem
                  internal_item_id="1"
                  internal_item_parent_id="114"
                  trans_unit_id="114-1"
                  internal_item_type="Normal">
                  <internal_items />
                </InternalNormalItem>
              </MarkdownSegment>
            </paragraph_segments>
            <PrefixWSLength>0</PrefixWSLength>
            <SuffixWSLength>0</SuffixWSLength>
          </MarkdownLine>
        </Lines>
        <paragraph_segments>
          <MarkdownSegment
            trans_unit_id="112">
            <SegmentId>e497ddb9-a11a-4cbe-ac79-13fab7052c4b</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="112"
              trans_unit_id="112-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
          <MarkdownSegment
            trans_unit_id="113">
            <SegmentId>2bd89a57-99e4-4ab3-b4c7-d9ec84d200c3</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="113"
              trans_unit_id="113-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
          <MarkdownSegment
            trans_unit_id="114">
            <SegmentId>b8f311a9-c8bf-41e3-96ce-74cb1679e01c</SegmentId>
            <InternalNormalItem
              internal_item_id="1"
              internal_item_parent_id="114"
              trans_unit_id="114-1"
              internal_item_type="Normal">
              <internal_items />
            </InternalNormalItem>
          </MarkdownSegment>
        </paragraph_segments>
      </MarkdownBlockBase>
      <MarkdownBlockBase
        xsi:type="MarkdownListBlock"
        item_id="ae62dd83-1143-4384-84a9-c5e4470d58a6"
        item_type="List"
        item_footer=""
        trans_unit_id="ae62dd83-1143-4384-84a9-c5e4470d58a6">
        <inner_list_items>
          <ListItem>
            <MarkdownParagraphBlock
              item_id="7f14ab49-b423-4832-8f29-6a74d08bee25"
              item_type="NormalParagraph"
              item_footer="footer_not_set"
              trans_unit_id="7f14ab49-b423-4832-8f29-6a74d08bee25">
              <Lines>
                <MarkdownLine>
                  <LineId>f4504833-6def-4db1-83a9-9ed3d9af0c11</LineId>
                  <paragraph_segments>
                    <MarkdownSegment
                      trans_unit_id="115">
                      <SegmentId>a604a4b3-3d07-4a6a-8839-f5bb460e3032</SegmentId>
                      <InternalNormalItem
                        internal_item_id="1"
                        internal_item_parent_id="115"
                        trans_unit_id="115-1"
                        internal_item_type="Normal">
                        <internal_items />
                      </InternalNormalItem>
                    </MarkdownSegment>
                  </paragraph_segments>
                  <PrefixWSLength>1</PrefixWSLength>
                  <SuffixWSLength>0</SuffixWSLength>
                </MarkdownLine>
              </Lines>
              <paragraph_segments>
                <MarkdownSegment
                  trans_unit_id="115">
                  <SegmentId>a604a4b3-3d07-4a6a-8839-f5bb460e3032</SegmentId>
                  <InternalNormalItem
                    internal_item_id="1"
                    internal_item_parent_id="115"
                    trans_unit_id="115-1"
                    internal_item_type="Normal">
                    <internal_items />
                  </InternalNormalItem>
                </MarkdownSegment>
              </paragraph_segments>
            </MarkdownParagraphBlock>
            <Identifier>  +</Identifier>
            <IndentsLength>
              <int>0</int>
            </IndentsLength>
          </ListItem>
          <ListItem>
            <MarkdownParagraphBlock
              item_id="352710f3-7296-43e4-ad03-32a2bf3cf02d"
              item_type="NormalParagraph"
              item_footer="footer_not_set"
              trans_unit_id="352710f3-7296-43e4-ad03-32a2bf3cf02d">
              <Lines>
                <MarkdownLine>
                  <LineId>ccc0ffc4-8f84-4aa1-ba41-1edb6ea78e42</LineId>
                  <paragraph_segments>
                    <MarkdownSegment
                      trans_unit_id="116">
                      <SegmentId>134da624-9937-4371-b265-f925bee335aa</SegmentId>
                      <InternalNormalItem
                        internal_item_id="1"
                        internal_item_parent_id="116"
                        trans_unit_id="116-1"
                        internal_item_type="Normal">
                        <internal_items />
                      </InternalNormalItem>
                    </MarkdownSegment>
                  </paragraph_segments>
                  <PrefixWSLength>1</PrefixWSLength>
                  <SuffixWSLength>0</SuffixWSLength>
                </MarkdownLine>
              </Lines>
              <paragraph_segments>
                <MarkdownSegment
                  trans_unit_id="116">
                  <SegmentId>134da624-9937-4371-b265-f925bee335aa</SegmentId>
                  <InternalNormalItem
                    internal_item_id="1"
                    internal_item_parent_id="116"
                    trans_unit_id="116-1"
                    internal_item_type="Normal">
                    <internal_items />
                  </InternalNormalItem>
                </MarkdownSegment>
              </paragraph_segments>
            </MarkdownParagraphBlock>
            <Identifier>  +</Identifier>
            <IndentsLength>
              <int>0</int>
            </IndentsLength>
          </ListItem>
          <ListItem>
            <MarkdownParagraphBlock
              item_id="cfbd1f3f-1283-47cf-b2c6-441ce96a0981"
              item_type="NormalParagraph"
              item_footer="footer_not_set"
              trans_unit_id="cfbd1f3f-1283-47cf-b2c6-441ce96a0981">
              <Lines>
                <MarkdownLine>
                  <LineId>01265529-dd4a-4c35-a720-0e754fc1d147</LineId>
                  <paragraph_segments>
                    <MarkdownSegment
                      trans_unit_id="117">
                      <SegmentId>c367d36e-c98b-4a08-8a19-9cf988d144f8</SegmentId>
                      <InternalNormalItem
                        internal_item_id="1"
                        internal_item_parent_id="117"
                        trans_unit_id="117-1"
                        internal_item_type="Normal">
                        <internal_items />
                      </InternalNormalItem>
                    </MarkdownSegment>
                  </paragraph_segments>
                  <PrefixWSLength>1</PrefixWSLength>
                  <SuffixWSLength>0</SuffixWSLength>
                </MarkdownLine>
              </Lines>
              <paragraph_segments>
                <MarkdownSegment
                  trans_unit_id="117">
                  <SegmentId>c367d36e-c98b-4a08-8a19-9cf988d144f8</SegmentId>
                  <InternalNormalItem
                    internal_item_id="1"
                    internal_item_parent_id="117"
                    trans_unit_id="117-1"
                    internal_item_type="Normal">
                    <internal_items />
                  </InternalNormalItem>
                </MarkdownSegment>
              </paragraph_segments>
            </MarkdownParagraphBlock>
            <Identifier>  +</Identifier>
            <IndentsLength>
              <int>0</int>
            </IndentsLength>
          </ListItem>
          <ListItem>
            <MarkdownParagraphBlock
              item_id="95ab8a6f-a5ea-488a-879d-68064efcea19"
              item_type="NormalParagraph"
              item_footer="footer_not_set"
              trans_unit_id="95ab8a6f-a5ea-488a-879d-68064efcea19">
              <Lines>
                <MarkdownLine>
                  <LineId>6a76d9ec-ec78-4b11-9561-d0ab2ea42ef9</LineId>
                  <paragraph_segments>
                    <MarkdownSegment
                      trans_unit_id="118">
                      <SegmentId>89d5792e-4d52-4926-bf68-5d6bf7775844</SegmentId>
                      <InternalNormalItem
                        internal_item_id="1"
                        internal_item_parent_id="118"
                        trans_unit_id="118-1"
                        internal_item_type="Normal">
                        <internal_items />
                      </InternalNormalItem>
                    </MarkdownSegment>
                  </paragraph_segments>
                  <PrefixWSLength>1</PrefixWSLength>
                  <SuffixWSLength>0</SuffixWSLength>
                </MarkdownLine>
              </Lines>
              <paragraph_segments>
                <MarkdownSegment
                  trans_unit_id="118">
                  <SegmentId>89d5792e-4d52-4926-bf68-5d6bf7775844</SegmentId>
                  <InternalNormalItem
                    internal_item_id="1"
                    internal_item_parent_id="118"
                    trans_unit_id="118-1"
                    internal_item_type="Normal">
                    <internal_items />
                  </InternalNormalItem>
                </MarkdownSegment>
              </paragraph_segments>
            </MarkdownParagraphBlock>
            <Identifier>  +</Identifier>
            <IndentsLength>
              <int>0</int>
            </IndentsLength>
          </ListItem>
        </inner_list_items>
        <ListType>Charactor</ListType>
      </MarkdownBlockBase>
      <MarkdownBlockBase
        xsi:type="MarkdownFencedCodeBlock"
        item_id="14948a27-3a6c-4c53-b279-cfd5eb205fd5"
        item_type="FencedCodeBlock"
        item_footer="&#xA;&#xA;&#xA;"
        trans_unit_id="14948a27-3a6c-4c53-b279-cfd5eb205fd5">
        <codeblock_wraper>```</codeblock_wraper>
        <code_block>// Add a reference to System.Fabric.Testability.dll and System.Fabric.dll.

using System;
using System.Fabric;
using System.Fabric.Testability;
using System.Fabric.Testability.Scenario;
using System.Threading;
using System.Threading.Tasks;

class Test
{
    public static int Main(string[] args)
    {
        // Replace these strings with the actual version for your cluster and appliction.
        string clusterConnection = "localhost:19000";
        Uri applicationName = new Uri("fabric:/samples/PersistentToDoListApp");
        Uri serviceName = new Uri("fabric:/samples/PersistentToDoListApp/PersistentToDoListService");

        Console.WriteLine("Starting Workload Test...");
        try
        {
            RunTestAsync(clusterConnection, applicationName, serviceName).Wait();
        }
        catch (AggregateException ae)
        {
            Console.WriteLine("Workload Test failed: ");
            foreach (Exception ex in ae.InnerExceptions)
            {
                if (ex is FabricException)
                {
                    Console.WriteLine("HResult: {0} Message: {1}", ex.HResult, ex.Message);
                }
            }
            return -1;
        }

        Console.WriteLine("Workload Test completed successfully.");
        return 0;
    }

    public enum ServiceWorkloads
    {
        A,
        B,
        C,
        D
    }

    public enum ServiceFabricFaults
    {
        RestartNode,
        RestartCodePackage,
        RemoveReplica,
        MovePrimary,
    }

    public static async Task RunTestAsync(string clusterConnection, Uri applicationName, Uri serviceName)
    {
        // Create FabricClient with connection &amp; security information here.
        FabricClient fabricClient = new FabricClient(clusterConnection);
        // Maximum time to wait for a service to stabilize
        TimeSpan maxServiceStabilizationTime = TimeSpan.FromSeconds(120);

        // How many loops of faults you want to execute
        uint testLoopCount = 20;
        Random random = new Random();

        for (var i = 0; i &lt; testLoopCount; ++i)
        {
            var workload = SelectRandomValue&lt;ServiceWorkloads&gt;(random);
            // Start workload and while it is running go and induce some fault
            var workloadTask = RunWorkloadAsync(workload);

            // While task is executing induce faults into the service. It can be ungraceful faults like
            // RestartNode and RestartDeployedCodePackage or graceful faults like RemoveReplica or MovePrimary
            var fault = SelectRandomValue&lt;ServiceFabricFaults&gt;(random);

            // Create a replica selector which will select a Primary replica from the given service to test
            var replicaSelector = ReplicaSelector.PrimaryOf(PartitionSelector.RandomOf(serviceName));
            // Run the selected random fault
            await RunFaultAsync(applicationName, fault, replicaSelector, fabricClient);
            // Validate the health and stability of the service.
            await fabricClient.ServiceManager.ValidateServiceAsync(serviceName, maxServiceStabilizationTime);

            // Wait for the workload to complete successfully
            await workloadTask;
        }
    }

    private static async Task RunFaultAsync(Uri applicationName, ServiceFabricFaults fault, ReplicaSelector selector, FabricClient client)
    {
        switch (fault)
        {
            case ServiceFabricFaults.RestartNode:
                await client.ClusterManager.RestartNodeAsync(selector, CompletionMode.Verify);
                break;
            case ServiceFabricFaults.RestartCodePackage:
                await client.ApplicationManager.RestartDeployedCodePackageAsync(applicationName, selector, CompletionMode.Verify);
                break;
            case ServiceFabricFaults.RemoveReplica:
                await client.ServiceManager.RemoveReplicaAsync(selector, CompletionMode.Verify, false);
                break;
            case ServiceFabricFaults.MovePrimary:
                await client.ServiceManager.MovePrimaryAsync(selector.PartitionSelector);
                break;
        }
    }

    private static Task RunWorkloadAsync(ServiceWorkloads workload)
    {
        throw new NotImplementedException();
        // This is where you trigger and complete your service workload
        // Please note the faults induced while your service workload is running will
        // fault the Primary service hence you will need to reconnect to complete or check
        // the status of the workload
    }

    private static T SelectRandomValue&lt;T&gt;(Random random)
    {
        Array values = Enum.GetValues(typeof(T));
        T workload = (T)values.GetValue(random.Next(values.Length));
        return T;
    }
}</code_block>
        <fenced_code_lang>csharp</fenced_code_lang>
      </MarkdownBlockBase>
    </ArrayOfMarkdownBlockBase>
  </block_element>
  <references>
    <ArrayOfMarkdownLinkedReference xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
  </references>
</markdown_skeleton_root>