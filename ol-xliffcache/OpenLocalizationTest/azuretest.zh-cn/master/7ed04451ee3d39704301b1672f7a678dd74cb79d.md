<properties
   pageTitle="Monitoring and diagnostics guidance | Microsoft Azure"
   description="Best practices for monitoring distributed applications in the cloud."
   services=""
   documentationCenter="na"
   authors="dragon119"
   manager="masimms"
   editor=""
   tags=""/>

<tags
   ms.service="best-practice"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="04/28/2015"
   ms.author="masashin"/>

# 監視と診断の手引き

![](media/best-practices-monitoring/pnp-logo.png)

## 概要
分散アプリケーションと、クラウドで実行されるサービスは、その性質、多くの可動部分を構成するソフトウェアの複雑な部分が。運用環境でユーザーがシステム、トレース リソース使用率を利用する方法を追跡することができるし、一般的に健康とシステムのパフォーマンスを監視することが重要です。この情報は、検出し、問題を修正、さらに潜在的な問題を助けるおよび発生を防ぐ診断の補助として使用できます。

## 監視と診断のシナリオ
監視を有効にどれだけシステムへの洞察力を得るためには機能しているし、保守サービスの品質目標の重要な一部です。監視データを収集するためのいくつかの一般的なシナリオがあります。

- システムが健康な状態であることを確認します。
- システムとそのコンポーネントの要素の可用性を追跡します。
- システムのスループットが、仕事の増加量として予期せず劣化しないことを確保するための性能を維持します。
- システムは顧客と合意した Sla を満たしていることを保証します。
- システム、ユーザー、およびそのデータのセキュリティとプライバシーの保護。
- 監査実行される操作または規制目的を追跡します。
- システムやヘルプ スポット動向、対処しない場合に問題につながる可能性の日常的な使用量の監視。
- 考えられる原因、整流、結果としてソフトウェアの更新、および展開の分析を通じて最初の報告から、発生する問題を追跡します。
- 操作のトレースとデバッグのソフトウェア リリース。

> [AZURE。メモ] このリストは包括的なものではありません。このドキュメント、監視を実行する最も一般的な状況としてこれらのシナリオに焦点を当てがあるかもしれないより少なく共通または各自の環境に固有の他。

これらのシナリオの詳細について説明します。各シナリオの情報は次の形式で説明します。

- シナリオの簡単な概要。
- このシナリオの一般的な要件。
- シナリオでは、この情報の原因をサポートするために必要な生のインストルメンテーション データ。
- どのようにこの生データを分析および有意義な診断情報を生成するために結合できます。

## 稼働状態の監視
システムは、それが実行中の要求を処理できる場合は健康です。健康を監視する目的は、システムのすべてのコンポーネントが期待どおりに機能していることを確認することを可能にするシステムの現在の状態のスナップショットを生成します。

### 健康を監視するための要件
オペレーターは、システムの任意の部分は健康とみなされる場合、すぐに (秒数) 以内警告必要があります。オペレーターは、システムのどの部分が正常とのどの部分に問題が発生を確認できる必要があります。トラフィック ライト システムを使用してシステムの正常性を強調できます。赤 (、システムが停止した)、不健康な黄色 (システムの機能制限で実行)、部分的に健康と緑の完全に健康な。

包括的な健康監視システムにより、オペレーターのサブシステムおよびコンポーネントの正常性状態を表示するシステムをドリル ・ ダウンします。たとえば、システム全体は、部分的に正常として描かれている、演算子は、ズーム インして機能が現在利用できない特定ができる必要があります。

### データ ソース、計測器、およびデータ収集の要件
正常性の監視をサポートするために必要な生のデータは、結果として生成できます。

- ユーザーの要求の実行をトレースします。この情報は、どの要求が成功した、失敗したが、各要求にかかる時間を決定する使用できます。
- 合成ユーザーを監視します。このプロセスは、ユーザーの実行手順をシミュレートし、定義済みの一連の手順に従います。各ステップの結果をキャプチャする必要があります。
- 例外、エラー、および警告をログに記録します。この情報は、アプリケーション コードに埋め込まれているだけでなく、システムによって参照されているすべてのサービスのイベント ログから情報を取得するトレース ステートメントの結果としてキャプチャできます。
- システムで使用される任意のサードパーティ製のサービスの状態を監視します。これは取得と、これらのサービスが提供する健康データを解析を必要があります、この情報は、さまざまな形式を取ることができます。
- エンドポイントを監視します。このメカニズムは、可用性監視セクションで詳細で説明です。
- I/o (ネットワークを含む) やバック グラウンドの CPU 使用率などの周囲のパフォーマンス情報を収集します。

### 健康データの分析
ヘルスモニタ リングの主な焦点は、すぐにシステムが実行されているかどうかを示すことです。(それはたとえば連続 ping の応答に失敗する) の健康する重要なコンポーネントが検出された場合、即時データのホットの分析はアラートをトリガーできます。演算子は、適切な是正措置を実行できます。

A more advanced system might include a predictive element that performs a cold analysis over recent and current workloads to spot trends and determine whether the system is likely to remain healthy or whether additional resources are going to be required. This predictive element should be based on critical performance metrics, such as the rate of requests directed at each service or subsystem, the response times of these requests, and the volume of data flowing into and out of each service. If the value of any metric exceeds a defined threshold the system can raise an alert to enable an operator or auto-scaling (if available) to take the preventative actions necessary to maintain system health. These actions might involve adding resources, restarting one or more services that are failing, or applying throttling to lower-priority requests.

## 可用性の監視
本当に健康的なシステムでは、コンポーネントおよびシステムを構成するサブシステムが使用できる必要があります。正常性の監視、密接に関連して、可用性の監視が、可用性の監視は、システムとそのコンポーネントに関するシステムの稼働時間の統計情報を生成するための可用性を追跡にかかわっている健康監視システムの現在の状態の即時ビューを提供するのに対し。

多くのシステムでいくつかのコンポーネント (データベースなど) は、重大な過失または接続の切断が発生した場合迅速なフェイル オーバーを許可するように冗長性が組み込まれてで構成されます。理想的には、ユーザーは、このような障害が発生しましたが、可用性監視の観点からしようと、原因を特定し、再発を防ぐための是正措置を取るような失敗についてできるだけ多くの情報を収集する必要がある必要がありますできません。

可用性を追跡するために必要なデータは、アプリケーション、システム、および環境に固有の可能性があります、下位レベルの要因の数に依存してあります。効果的な監視システムでは、これらの低レベルの要因に対応し、システムの全体像を与えるためにそれらを集約し、可用性データをキャプチャします。たとえば、e コマース システム、注文するお客様のビジネス機能を注文の詳細が格納され、これらの注文の支払いのための金融取引を処理する決済システムのリポジトリに依存します。システムの発注一部の可用性したがってリポジトリおよび支払システムの可用性の機能です。

### 可用性の監視のための要件
オペレーターは各システムおよびサブシステムの歴史的な空室状況を表示し、定期的に失敗する 1 つまたは複数のサブシステムを引き起こす可能性のあるトレンドを発見するこの情報を使用することもする必要があります (サービス開始か処理のピーク時に対応する日の特定時に失敗?)

空室状況の即時および歴史的なビューを提供するだけでなく、あるいは各サブシステムの監視ソリューションできる必要がありますも 1 つオペレーターにすぐに警告またはより多くのサービスが失敗したりユーザーがサービスに接続することができます。これは単に各サービスを監視するが、サービスとの通信を試みると、これらの操作が失敗した場合に、各ユーザーによって実行されるアクションも検討の問題ではありません。ある程度、接続障害の程度は通常、一時的なエラーが原因である可能性がありますが、それは特定の時間期間中に指定されたサブシステムに障害が発生した接続数の警告を出すシステムを許可する役に立つかもしれません。

### データ ソース、計測器、およびデータ収集の要件
同様に正常性の監視、監視とロギング例外、エラー、警告が発生する可能性があります合成ユーザーの結果として raw データの可用性の監視をサポートする必要を生成できます。さらに、可用性データは、エンドポイントの監視を実行するから入手できます。アプリケーションは、1 つまたは複数の健康エンドポイント、各システム内の機能領域へのテストを公開できます。監視システムは、定義されたスケジュールに従って各エンドポイントに ping を実行し、結果 (成功または失敗) を収集できます。

タイムアウトとネットワーク接続性の障害、接続の再試行回数を記録する必要があります。すべてのデータは、タイムスタンプする必要があります。

<a name="analyzing-availablity-data"></a>
### 可用性データの分析
インストルメンテーション データを集計、相関分析の次の種類をサポートする必要があります。

- システムとサブシステムの当面の空室状況。
- システムとサブシステムの可用性故障率。理想的にはオペレーターが特定活動に障害を関連付けることする必要があります。システムが失敗したとき、何が起こっていたか。
- 史観のシステムまたは任意のサブシステムすべてにわたって故障率のときに指定した期間、および読み込みシステム (たとえばユーザー要求数) にエラーが発生しました。
- システムまたはサブシステムの利用できない理由。たとえば、サービス、接続、接続の切断を実行していないが、タイムアウト、エラー接続ですが返される。

数式を使用して時間の期間にわたって、サービスの可用性の割合を計算できます。

```
%Availability =  ((Total Time – Total Downtime) / Total Time ) * 100
```

これは、SLA の目的 (便利[SLA の監視](#SLA-monitoring) 記載されてこのガイドで後述)。定義 _ダウンタイム_ サービスによって異なります。たとえば、Visual Studio のオンラインはその期間内に接続が確立された後その中にお客様のサービスに接続しよう取る 120 秒とすべてのベーシックの読み取りおよび書き込み操作の失敗よりも長い期間とダウンタイムを定義します。

## パフォーマンスの監視
システムとしては、ユーザーの増加の量とこれらのユーザー アクセスの成長、1 つまたは複数のコンポーネントが可能な故障なる可能性がデータセットのサイズとしてより多くのストレスの下で配置されます。多くの場合、コンポーネントの障害、パフォーマンスの低下続きます。できる場合は、状況を改善するための積極的な措置を取ることができるそのような減少を検出します。

システムのパフォーマンスは、いくつかの要因に依存しています。各因子は、通常 1 秒間にデータベース トランザクションの数など一定の期間で正常にネットワーク要求のボリューム主要業績評価指標 (Kpi) を使用して測定されます。他はメトリックの組み合わせに由来するかもしれないがこれらの Kpi のいくつかは特定のパフォーマンス対策として利用できるかもしれない。

> [AZURE。メモ] 悪い、または良いパフォーマンスを決定するでシステムを実行する必要がありますパフォーマンスのレベルを理解することが必要です。これは、典型的な負荷の下で機能している間、システムを観察し、各 KPI の時間の期間にわたってデータをキャプチャに必要です。これは、テスト環境でシミュレートされた負荷の下でシステムを実行し、システムを運用環境に展開する前に適切なデータの収集を伴う場合があります。

> また、パフォーマンスのための監視があるシステム上の不当な負担にしてください。プロセスの監視パフォーマンスの収集データに関する詳細情報のレベルを動的に調整することができます。

### パフォーマンスを監視するための要件
システムのパフォーマンスを調べる演算子通常などの情報を参照してくださいする必要があります。

- ユーザーの要求の応答速度。
- 同時ユーザー要求の数。
- ネットワーク トラフィックのボリューム。
- ビジネスで取引が完了している料金です。
- 要求の平均処理時間。

スポットの相関を助けるようにオペレーターを有効にするツールを提供するために役立つことができます。

- 要求の待ち時間と同時ユーザーの数 (どのくらいユーザーがそれを送信した後、要求の処理を開始する)。
- 平均応答時間に対する同時接続ユーザー数 (どのくらい処理が開始された後は、要求を完了する)。
- 処理エラーの数と要求の量。

この高度な機能については、だけでなく、オペレーターがシステムの各コンポーネントのパフォーマンスの詳細なビューを取得することがあります。このデータは、追跡情報など、低レベルのパフォーマンス カウンターを使用して通常提供されます。

- メモリ使用率
- スレッドの数
- CPU の処理時間
- 要求キューの長さ
- ディスクまたはネットワーク I/O レートとエラー、
- 書き込みまたは読み取りバイト数
- キューの長さなどのミドルウェアの指標。

すべての視覚エフェクト期間; を指定する演算子を許可する必要があります。表示されるデータは、現在の状況のスナップショットおよび/またはパフォーマンスの履歴が表示可能性があります。

演算子は、任意の指定した時間間隔の間にある特定の値の任意のパフォーマンスの測定に基づくアラートを生成することができるはず。

### データ ソース、計測器、およびデータ収集の要件
彼らが到着し、システムを通過するとユーザーの要求の進行状況を監視することによって (スループット、同時接続ユーザー数、取引数、エラー ・ レートなど)、高度なパフォーマンス データを収集できます。これは、タイミング情報とアプリケーション コードの主要ポイントでトレース ステートメントを組み込むことを含みます。すべてのエラー、例外、および警告は、それらの原因となった要求と関連付けるようにするのに十分なデータでキャプチャする必要があります。IIS ログは別の有用なソースです。

可能であれば、またアプリケーションが使用する外部システムはすべてのパフォーマンス データをキャプチャする必要があります。これらの外部システム パフォーマンス データを要求するため、独自のパフォーマンス カウンターやその他の機能を提供しました。できない場合、開始時間や操作のステータス (成功、失敗、または警告) と共に、外部システムへの各要求の終了時間などの情報を記録する必要があります。時間要求にストップウォッチのアプローチを使用できますたとえば、起動時に要求を実行する timer を起動し、要求が完了するときにタイマーを停止します。

システムの個々 のコンポーネントの低レベルのパフォーマンス データは、Windows パフォーマンス カウンターや Azure 診断などの機能を通じて利用可能なあります。

### パフォーマンス データの分析
ユーザー要求の種類 (ショッピング カートにアイテムを追加する、電子商取引システムでチェック アウト プロセスを実行するなど) またはサブシステム、各要求が送信されるサービスによってパフォーマンス データの集計分析作業の多くで構成されています。

もう 1 つの一般的な要件が選択された百分位数のパフォーマンス データを集計します。たとえば、リクエストの 99%、95% の要求、要求の 70% に応答時間を決定します。SLA の目標があるか、各パーセン タイルの他の目標を設定します。両方で継続的な結果を報告するべきである即時の問題を検出するためにリアルタイムに近いだけでなく、統計目的のため長い時間をかけて集計されています。

待ち時間の問題は、パフォーマンスに影響を与える、場合オペレーターは迅速に各要求によって実行される各手順の遅延を調べることによって、ボトルネックの原因を特定することができますする必要があります。パフォーマンス データしたがって特定の要求にそれらを結ぶ各ステップのパフォーマンス測定値を関連付けるための手段を用意します。

可視化の要件に応じて生成し、複雑なアドホック クエリを実行できるように raw データのビューとパフォーマンス情報の分析を含むデータ キューブに格納すると便利場合があります。

## セキュリティの監視
機密性の高いデータを含むすべての商業システムは、セキュリティ構造を実装する必要があります。セキュリティ メカニズムの複雑さは通常データの機密性の機能です。ユーザーを認証を必要とするシステム、彼らは失敗するか成功するかどうかすべてのログイン試行を記録する必要があります。また、すべての操作の実行、認証済みのユーザーによってアクセスされるすべてのリソースの詳細を記録する必要があります。ユーザーが自分のセッションが終了するし、ログアウトする、この情報も記録されなければなりません。

監視システムに攻撃を検出することができるかもしれません。たとえば、失敗したログイン試行の数が多いは、ブルート フォース攻撃を示す可能性があります。 または要求で予期せぬサージは、DDoS 攻撃の結果かもしれない。あなたはこれらの要求のソースに関係なくすべてのリソースに対するすべての要求を監視する準備する必要があります。ログインの脆弱性を持つシステムは、ユーザーが実際にログインしなくても外の世界にリソースを公開誤って可能性があります。

### セキュリティの監視の要件
セキュリティ監視の最も重要な側面は、すぐに演算子は、有効にする必要があります。

- 認証されていないエンティティによって試みられた侵入を検出します。
- 与えられていないアクセス、データに対して操作を実行するエンティティによって試みを識別します。
- システム、またはシステムの一部は、外部または内部からの攻撃の下でかどうかを決定する (たとえば、認証された悪意のあるユーザーがしようとシステムをダウンさせる)。

これらの要件をサポートするには、オペレーターに通知する必要があります。

- 繰り返される任意の指定された時間期間内の同じアカウントにログイン試行に失敗しました。
- 場合は、同じ認証されたアカウントは、繰り返し指定された期間中に禁止されているリソースにアクセスしようとします。
- 場合は、多数の認証または承認されていない要求は、指定された期間中に発生します。

オペレーターに提供される情報は、要求ごとにソースのホスト アドレスを含める必要があります。特定のアドレスの範囲から定期的にセキュリティ違反が発生した場合は、これらのホストが禁止でした。

A key part in maintaining the security of a system is being able to quickly detect actions that deviate from the usual pattern. Information such as the number of failed and/or successful login requests can be displayed visually to help detect whether there is a spike in activity at an unusual time (such as users logging in at 3am and performing a large number of operations when their working day starts at 9am). This information can also be used to help configure time-based autoscaling, For example, if an operator observes that a large number of users regularly log in at a particular time of day, the operator can arrange to start additional authentication services to handle the volume of work, and then shut these additional services down when the peak has passed.

### データ ソース、計測器、およびデータ収集の要件
セキュリティは、ほとんどの分散システムのすべての包括的な側面と関連データがシステム全体の複数の場所で生成される可能性があります。アプリケーション、ネットワーク機器、サーバー、ファイアウォール、ウイルス対策ソフトウェア、およびその他の侵入防止の要素で発生したイベントに起因するセキュリティ関連の情報を収集するために、セキュリティ情報およびイベント管理 (SIEM) アプローチを採用することを検討してください。

セキュリティの監視は、外部格付機関、または、アプリケーションおよびデータへの認証されていないアクセスの試みを検出するネットワーク フィルターによってポート スキャン アクティビティを特定するユーティリティなどのアプリケーションの一部ではないツールからのデータを組み込むことができます。

すべてのケースで収集されたデータは、管理者が任意の攻撃の性質を判断し、適切な対策を取るを有効にしなければなりません。

### セキュリティ データの分析
セキュリティの監視の機能は、さまざまなソースのデータが発生します。異なるフォーマットと詳細のレベルは、情報の一貫したスレッドにまとめるにキャプチャ データの複雑な分析を多く必要です。(多数のログインに失敗した、または重要なリソースへの不正アクセスを得るために繰り返された試みを検出) などの場合の最も簡単な離れてそれできない可能性があります、セキュリティ データの複雑な自動処理を実行して、代わりにタイムスタンプが、それ以外の専門家が手動解析できるようにするセキュリティで保護されたリポジトリに、元の形式で、このデータを記述することが望ましいがあります。

<a name="SLA-monitoring"></a>

## SLA の監視
多くの商用システムの有料顧客をサポートする Sla の形でシステムのパフォーマンスに関する保証もします。基本的に、Sla は、システムが重要な情報を失うことがなく合意された期間内の仕事の定義済みのボリュームを処理できる状態します。SLA の監視システムには測定可能な sla を確保することです。

> [AZURE。メモ] SLA の監視密接に関連してパフォーマンスの監視、パフォーマンスの監視は、システムの機能を確保することにかかわっているに対し、 _最適な_、何を定義する契約上の義務によって支配される SLA の監視 _最適な_ 実際に意味します。

Sla の定義は頻繁です。

- システム全体の可用性。たとえば、組織は、システムは、時間の 99.9% のため使用できる保証場合があります。これは、年間では、ダウンタイムは 1 週間約 10 分の 9 時間以上に相当します。
- 操作のスループット。この面は、1 つまたは複数キー高ウォーターマーク、システムは最大 100,000 の同時ユーザー要求をサポートまたは 10,000 の同時取引を処理することができることを保証するなどとして表されます。
- 操作の応答時間。システムはビジネス トランザクションのすべての 99% は 2 秒以内に完了の要求が処理される速度をに関する保証をすることができるも、1 つのトランザクションがない 10 秒より長くかかります。

> [AZURE。メモ] 商用システムのいくつかの契約は、Sla に関するカスタマー サポートなどすべてのヘルプ デスク要求は 5 分以内で応答を引き出すと、すべての問題の 99% は、一営業日以内に完全に対処する必要がもあります。効果的です [懸案事項の管理](#issue-tracking) (このセクションで後述) が sla をこれらのように重要です。

### SLA を監視するための要件
オペレーターは、最高レベルのシステムが合意された Sla を満たしてしているかどうか、かどうかおよびドリル ダウンしパフォーマンスの低下の理由を決定する根本的な要因を検討していない場合を一目で確認できる必要があります。

視覚的に描くことができます典型的なの大まかな指標が含まれます。

- サービスの稼働時間の割合です。
- アプリケーションのスループット (取引の成功および/または 1 秒あたりの操作の面で測定される)。
- 成功した/失敗したアプリケーション要求の数。
- アプリケーションおよびシステムのエラー、例外、および警告の数。

すべてのこれらの指標の一定の時間によってフィルター処理されてできる必要があります。

クラウド アプリケーションのサブシステムおよびコンポーネントの数で構成される可能性があります。オペレーターは、大まかな表示を選択し、基になる要素の健康からで構成される方法を参照してくださいすることがする必要があります。たとえば、システム全体の稼働率を下回る許容値、演算子は、ズームインし、どの要素がこの障害に貢献している判断ができる必要があります。

> [AZURE。メモ] システムの稼働時間は慎重に定義する必要があります。最大の可用性を確保するための冗長性を使用するシステムでは、要素の個々 のインスタンスが失敗することがありますがシステム機能を維持することができます。正常性の監視によって表されるシステムの稼働時間は、システムが実際に停止したかどうかとは必ずしも各要素の総稼働時間を示す必要があります。また、障害があります分離での機能低下が特定システムが利用できない場合でも、システムの残りの部分は使用可能な場合がありますので (e コマース システム、システムで障害が発生は注文から顧客を防ぐ可能性がありますが、顧客が製品カタログを参照することがあります)。

目的を警告するため、システムは大まかな指標のいずれかが指定したしきい値を超えた場合にイベントを発生させることができるはず。高レベルのインジケーターを構成するさまざまな要素の下位レベルの詳細コンテキスト データを警告システムとして利用できます。

### データ ソース、計測器、およびデータ収集の要件
SLA の監視をサポートするために必要な生データ、パフォーマンスの状態と可用性の監視のいくつかの側面と共に監視を必要とすると似ています (詳細については、これらのセクションを参照してください)。このデータをキャプチャすることができます。

- エンドポイントの監視を実行します。
- 例外、エラー、および警告をログに記録します。
- ユーザーの要求の実行をトレースします。
- システムで使用される任意のサードパーティ製のサービスの可用性を監視します。
- パフォーマンス メトリックおよびカウンターを使用します。

すべてのデータは、タイミングし、タイムスタンプする必要があります。

### SLA データの分析
インストルメンテーション データは、システムの全体的なパフォーマンスの画像を生成する、基になるサブシステムの性能の検討を可能にするドリル ダウンをサポートするために集約する必要があります。たとえば、することができます。

- 一定期間ユーザー要求の合計数を計算し、これらの要求の成功と失敗の率を決定します。
- システム応答時間の全体的なビューを生成、ユーザー要求の応答時間を組み合わせます。
- 進捗状況を分析ユーザー要求がブレークポイントの要求の全体的な応答時間をその要求の個々 の作業項目の応答時間に。  
- 任意の一定の割合の稼働時間として、システムの全体的な可用性を決定します。
- システムの個々 のコンポーネントやサービスのそれぞれの時間の可用性の割合を分析します。これはサード パーティのサービスで生成するログの解析を伴うことがあります。

多くの商用システムは、指定された期間、通常月の合意された Sla に対する実際のパフォーマンスの数字を報告する必要があります。この情報は、その期間中に、Sla が満たされない場合顧客にクレジットまたは返済の他の形態を計算する使用ことができます。セクションで説明する手法を使用してサービスの可用性を計算できます。 [可用性データの分析](#analyzing-availability-data).

内部目的組織も数とサービスの失敗の原因となった事件の性質を追跡可能性があります。ダウンタイムを短縮し、Sla の達成を助けるこれらの問題を迅速に解決したり、完全に排除する方法を学習します。

## 監査
アプリケーションの性質に応じて、ユーザーとすべてのデータ アクセスの記録によって実行される操作の監査の要件を指定する法定またはその他の法的規制があります。特定の要求に対して顧客をリンクする証拠を提供できる監査否認は、顧客とアプリケーションまたはサービスを担当する組織の信頼を維持するために多くの e ビジネス システムの重要な要因があるとあります。

### 監査の要件
アナリストは、ユーザーの行動を再構築することができますは、ユーザーが実行している業務の過程を追跡できる必要があります。これは、レコードの問題として単にまたはフォレンジック調査の一部として必要があります。

監査情報があります機密性の高い可能性が実行しているタスクと共にシステムのユーザーを識別するデータが含まれます。このため、ドリル ダウン グラフィカル操作をサポートする対話型システムを使用してなく監査情報はのみ可能な信頼されたアナリスト レポートの形で可視化される可能性が最も高いです。アナリストは、たとえば単一ユーザーの活動年表の詳細またはシーケンス操作が 1 つまたは複数のリソースに対して実行特定の期間中に発生したすべてのユーザーの活動をリスト、レポートの範囲を生成することができるはず。

### データ ソース、計測器、およびデータ収集の要件
監査のための情報の主要な情報源があります。

- ユーザー認証を管理するセキュリティ システムです。
- ユーザーの利用状況を記録するログをトレースします。
- セキュリティは、すべての個人情報と非個人のネットワーク要求を追跡記録します。

監査データが格納されている方法の形式は、規制要件によって駆動する可能性があります。たとえば、それは (それは元の形式で記録される必要があります) 何らかの方法でデータをきれいにすることができない場合があり、改ざんを防止するそれが開催されますリポジトリへのアクセスを保護する必要があります。

### 監査データの分析
アナリストは、そのまま元の形式の生のデータにアクセスできる必要があります。別に共通する要件監査レポート、このデータを分析に使用するツールは特化しシステムに外部保存可能性が高い。

## 利用状況の監視
利用状況の監視機能と、アプリケーションのコンポーネントの使用方法を追跡します。収集したデータを利用することができます。

- 機能の使用頻度が高いとシステムの潜在的なホット スポットを確認決定します。高トラフィックの要素は、機能分割またはもレプリケーション負荷をより均等に分散するから寄与できます。この情報は、機能の使用頻度の低いと可能な候補者は、退職またはシステムの将来のバージョンで置換を確認するためにも使用できます。
- 通常の使用の下でシステムの稼働中のイベントに関する情報を取得します。たとえば、e コマース サイトのトランザクションの数とそれらのための責任がある顧客の量に関する統計情報を記録します。この情報は、容量計画のお客様の数が増えるにつれて使用可能性があります。
- パフォーマンスとシステムの機能にユーザーの満足度検出 (多分間接的に) します。たとえば、e-コマース システムの顧客の多数は定期的に、ショッピング カートを放棄する場合、これはチェック アウト機能の問題が原因かもしれない。
- 課金情報を生成します。商用アプリケーションやマルチ テナント サービスは、彼らが使用するリソースのための顧客を満たすかもしれない。
- クォータを適用します。マルチ テナント システム内のユーザーは、指定された期間中に時間やリソースの使用状況を処理する彼らの有料のクォータを超えた場合、そのアクセス制限できるまたは処理の調整。

### 使用状況を監視するための要件
システムの使用状況を調べる演算子通常などの情報を参照してくださいする必要があります。

- 各サブシステムによって処理され、各リソースに指示されている要求の数。
- 各ユーザーによって実行される作業。
- 各ユーザーによって占められるデータ ストレージのボリューム。
- 各ユーザーによってアクセスされるリソース。

オペレーター必要があります、グラフを生成することができますたとえば、最もリソースを消費したり、最も頻繁にアクセスされるリソースを表示します。

### データ ソース、計測器、およびデータ収集の要件
利用状況の追跡は、各要求の開始と終了の時刻と (読み取り、書き込み、およびように、問題のリソースによって) 要求の性質を指摘し、比較的高いレベルで実行できます。この情報を取得できます。

- ユーザーの利用状況をトレースします。
- キャプチャのパフォーマンス カウンターは、各リソースの使用率を測定します。
- 各ユーザーによって実行される操作の CPU や I/O の使用率を監視します。

目的を計量のためまたアイデンティティをどのユーザーが実行する操作、およびこれらの操作を利用するリソースを担当することができる必要があります。収集した情報は、正確な請求を有効にするのに十分な詳細。

<a name="issue-tracking"></a>
## 懸案事項の管理
お客様および他のユーザーは、システムで予期しないイベントや動作が発生した場合に問題を報告する場合があります。問題追跡はこれらの問題を管理する、システムで任意の根本的な問題を解決するための努力にそれらを関連付ける、可能な解像度の顧客を知らせることにかかわっています。

### 問題追跡の要件
懸案はしばしば演算子を記録し、ユーザーによって報告された問題の詳細を報告することができます別のシステムを使用して実行されます。これらの詳細には、ユーザーが実行しようとして症状の問題、一連のイベント、およびエラー メッセージや警告メッセージに発行されたタスクなどの情報を含めることができます。

### データ ソース、計測器、およびデータ収集の要件
問題追跡データの初期データ ソースは、最初の場所で問題を報告したユーザーです。クラッシュ ダンプ (存在する場合は、アプリケーションは、ユーザーのデスクトップで実行されるコンポーネントを含む)、画面スナップショット、日付、場所などその他の環境情報と共にエラーが発生した時刻などの追加データを提供することができます。

この情報は、デバッグ作業にフィードを使用できます、ソフトウェアの今後のリリースのバックログを構築するのに役立ちます。

### 問題の追跡データの分析
別のユーザーが同じ問題を報告ことがあります、問題追跡システムは、一緒に共通のレポートを関連付ける必要があります。

各問題レポートに対してデバッグ作業の進行状況を記録して、ソリューションの顧客を通知ことができます問題を解決する場合。

ユーザーは、問題追跡システムの知られているソリューションと認識された問題を報告する場合オペレーターはソリューションのユーザーにすぐに通知することができるはず。

## 操作のトレースとデバッグのソフトウェア リリース
ユーザーは、問題を報告、ユーザーは彼または彼女の操作に、ユーザーのみ報告できます自分の経験の結果システムの保守を担当オペレーターに直接的な影響を認識して頻繁にただ。これらの経験は、通常、1 つまたは複数の基本的な問題の目に見える症状だけです。(このプロセスと呼ばれます問題の根本的な原因を確立する基盤となる操作の年表を掘るする必要があります多くの場合、アナリスト _根本原因の解析_).

> [AZURE。メモ] 根本原因解析アプリケーションのデザインの非効率な部分が明らかに。これらの状況では、影響を受ける要素を手直しし、後続のリリースの一部として配置可能ながあります。このプロセスは、注意制御を必要とし、更新されたコンポーネントを密接に監視する必要があります。

### トレースとデバッグの要件
予期せぬ出来事やその他の問題をトレースするための監視データは高レベルで発生する問題についてだけの十分な情報を提供しますが、またアナリストがこれらの問題の起源に戻るトレースを有効にして、発生したイベントのシーケンスを再構築するための十分な詳細が含まれていますが重要です。この情報は、開発者は、再発を防ぐために必要な変更を加えることができるように、問題の根本的な原因を診断するアナリストを有効にするのに十分でなければなりません。

### データ ソース、計測器、およびデータ収集の要件
トラブルシューティング トレース、顧客が特定の要求をするときは、システム内の論理の流れを描いたツリーを構築する処理の一部として呼び出されるすべてのメソッド (とそのパラメーター) を含むことができます。例外は、この流れの結果としてシステムによって生成された警告記録、キャプチャする必要があります。

デバッグをサポートするには、システムは、システムの重大なポイントで状態情報をキャプチャする演算子を有効にするフックを提供または選択された操作の進行状況として詳細なステップバイ ステップの情報をお届けできます。さらに課すことができるこの詳細レベルでデータをキャプチャ システムの負荷は、複製が困難である非常に珍しい一連のイベントが発生したとき、または 1 つの新しいリリースを主に使用される一時的なプロセスをする必要がありますまたは期待どおりに機能することを確保するため見極めシステムにより多くの要素が必要です。

## 監視と診断のパイプライン
重要な課題を提起する大規模な分散システムを監視し、前のセクションで説明するシナリオのそれぞれ見なす必要がありますいない必ずしも単独で。このデータが処理され、さまざまな方法で提示する必要がありますが、それぞれの状況に必要な監視および診断データの重要な重複をする可能性があります。これらの理由から、監視と診断の全体的なビューを取る必要があります。

施設は図 1 に示す段階パイプラインとして全体の監視と診断のプロセスを想定することができます。

![](media/best-practices-monitoring/Pipeline.png)

_図 1。
監視と診断のパイプラインの段階_

Figure 1 highlights how the data for monitoring and diagnostics can come from a variety of data sources. The Instrumentation/Collection stage is concerned with instrumentation; determining which data to capture, how to capture it, and how to format this data so that it can be easily examined. The Analysis/Diagnosis phase takes the raw data and uses it to generate meaningful information that can be used to determine the state of the system. This information can be used to make decisions about possible actions to take, and the results can be fed back into the Instrumentation/Collection phase. The Visualization/Alerting stage phase presents a consumable view of the system state; it could display information in near real-time by using a series of dashboards, and it could generates reports, graphs, and charts to provide a historical view of the data that can help identify long-term trends. If information indicates that a KPI is likely to exceed acceptable bounds, then this stage can also trigger an alert to an operator. In some cases, an alert can also be used to trigger an automated process that attempts to take corrective actions, such as auto-scaling.

手順が段階を並列で発生している連続的なフロー プロセスを構成することに注意してください。理想的には、すべての段階を動的に構成可能でする必要があります。いくつかの点でシステムが新しく展開されているまたは、問題が発生している場合は特により頻繁に拡張データを収集するために必要な場合があること。他の回でそれはシステムが正常に機能していることを確認する重要な情報の基本レベルをキャプチャすることが可能する必要があります。

さらに、全体の監視プロセスの微調整とフィードバックの結果として改善されるライブ、継続的なソリューションと見なさ必要があります。たとえば、システムの状態を判断する多くの要因を測定する場合の開始可能性があります時間をかけて分析につながる可能性しますが、洗練無関係で対策を破棄するより正確に必要なデータに焦点を当てるようにすること、任意のバック グラウンド ノイズを最小限に抑えながら。

## 監視および診断データのソース
The information used by the monitoring process can come from several sources, as illustrated in Figure 1. At the application level, information comes from trace logs incorporated into the code of the system. Developers should follow a standard approach for tracking the flow of control through their code (for example, on entry to a method emit a trace message that specifies the name of the method, the current time, the value of each parameter, and any other pertinent information. Recording the entry and exit times could also prove useful). You should log all exceptions and warnings, and ensure that you retain a full trace of any nested exceptions and warnings. Ideally, you should also capture information that identifies the user running the code together with activity correlation information (to track requests as they pass through the system), and log attempts to access all resources such as message queues, databases, files, and other dependent services; this information can be used for metering and auditing purposes.

多くのアプリケーションを作るライブラリとフレームワークを使用して、データ ストアへのアクセスや、ネットワークを介した通信などの一般的なタスクを実行します。これらのフレームワークは、独自のトレース メッセージとトランザクション ・ レート、データ伝送成功と失敗など生の診断情報の出力に設定可能します。

> [AZURE。メモ] 現代の多くのフレームワークは自動的にパフォーマンスとトレース イベントを公開し、単に取得して処理や分析することができますそれを格納する手段を提供するは、この情報をキャプチャします。

アプリケーションが実行されているオペレーティング システムは、I/O レート、メモリ使用率と CPU 使用率を示すパフォーマンス カウンターなどの低レベルのシステム全体の情報のソースにすることができます。(ファイルが正しく開く障害) などのオペレーティング システム エラーも報告される可能性があります。

また、基になるインフラストラクチャとシステムを実行するコンポーネントを検討してください。仮想マシン、仮想ネットワーク、ストレージ サービス、重要なインフラストラクチャ レベルのパフォーマンス カウンターのソースおよび他の診断データをするすべてのことができます。

アプリケーションが web サーバーまたはデータベース管理システムなどの他の外部サービスを使用している場合これらのサービスは、独自のトレース情報、ログ、およびパフォーマンス カウンターを公開したり。SQL Server データベースに対して実行された操作を追跡するため SQL Server の動的管理ビューがあります、インターネット インフォメーション サーバー トレース ログは、web サーバーに対する要求を記録するため。

システムのコンポーネントは変更し、新しいバージョンを展開、属性、イベント、および各バージョンに指標することができることが重要です。この情報は、コンポーネントの特定のバージョンで問題をすばやく追跡して修正できるようにリリース パイプラインに結合する必要があります。

セキュリティ上の問題は、システムで任意の時点で発生する可能性があります。ユーザーが無効なユーザー ID またはパスワードを使用してログインを試みる可能性がありますたとえば、認証済みのユーザーがリソースに無許可でアクセスしてみてください。または、ユーザーが無効なまたは古いキーで暗号化された情報にアクセスを提供可能性があります。成功および失敗した要求のセキュリティ関連情報を記録常にする必要があります。

セクション [アプリケーションのインストルメント化](#instrumenting-an-application) あなたをキャプチャする必要があります、しかし、最初の場所でこの情報を収集するために使用することができます戦略のさまざまな情報をさらにガイダンスが含まれています。

- **アプリケーション/システム監視**.この戦略は、アプリケーション、アプリケーション フレームワーク、オペレーティング システム、およびインフラストラクチャ内の内部ソースを使用しています。アプリケーション コード自体を生成独自のクライアント要求のライフ サイクルの中に注目すべき点のデータを監視できます。アプリケーションは、選択的に有効または無効も状況に応じて可能性がありますトレース ステートメントを含めることができます。それは診断フレームワークを使用して診断を動的に挿入することもできます。これらのフレームワークでは、プラグインは、コード内のさまざまな計測ポイントに接続し、これらのポイントでトレース データをキャプチャできます通常提供します。

さらに、あなたのコードおよび基盤となるインフラストラクチャの重要なポイントでイベントを発生させる可能性があります。これらのイベントをリッスンするように構成されたエージェントを監視すると、イベント情報が記録できます。

- **実ユーザの監視**.このアプローチは、ユーザーとアプリケーションの相互作用を記録し、各要求と応答の流れを観察します。この情報は、二つの目的を持つことができます: 各ユーザーが、使用量を計量するため使用されることができます、ユーザーが適切な品質のサービス (たとえば、高速な応答時間、低レーテンシー、そして発生する最小限のエラー) を受けているかどうかを決定する使用できます。キャプチャされたデータは、システムが遅く、おそらくボトルネックのいくつかの他のフォームまたはアプリケーションのホット スポットのための最もよく障害が発生する懸念や要素の領域を識別する使用できます。このアプローチが慎重に実装されている場合、デバッグとテストの目的でアプリケーション ユーザーの流れを再構築することが可能かもしれません。

	> [AZURE。重要です] 実際のユーザーを監視することによってキャプチャされたデータは、機密情報が含まれる場合、機密性の高い考慮されなければなりません。キャプチャしたデータを保存する場合は、安全に格納する必要があります。パフォーマンスの監視、またはデバッグの目的のためのデータを使用している場合は、すべての個人を特定できる情報を最初に取り除く必要が。

- **合成ユーザーの監視**.このアプローチは、ユーザーをシミュレートし、構成可能な典型的な一連の操作を実行するテスト クライアントを記述します。システムの状態を確認するためのテスト クライアントのパフォーマンスを追跡することができます。ロード テストの操作の一部としてテスト クライアントの複数のインスタンスを使用して、ストレスの下でのシステムの応答方法およびこれらの条件下でどのような出力を監視が生成されますを確立することができますも。

	> [AZURE。メモ] 現実と合成ユーザーのコードをトレースし、メソッドの呼び出しとアプリケーションの他の重要な部分の実行時間を含む監視を実装できます。

- **プロファイリング**.このアプローチは主に対象のモニタリングとアプリケーションのパフォーマンスを改善に。なく、現実と合成ユーザーの監視によって採用の機能レベルで動作し、アプリケーションの実行中に低レベル情報を捕捉します。(時間で特定の時点でアプリケーションが実行されているコードのどの部分の決定)、アプリケーションの実行状態の周期的なサンプリングまたは (開始およびメソッド呼び出しの最後) など重要な局面でコードにプローブを挿入し、何時、どのメソッドが呼び出されたことを記録するインストルメンテーションを使用して、プロファイリングをによって実装できます。、各呼び出しに要したとします。このデータは、アプリケーションのどの部分でパフォーマンス問題を引き起こす可能性を決定する分析できます。

- **エンドポイントの監視**.この技法は、監視を有効にする具体的には、アプリケーションによって公開された 1 つまたは複数の診断エンドポイントを使用します。エンドポイントはアプリケーション コードに経路を提供し、システムの状態に関する情報を返すことができます。さまざまなエンドポイントは、機能のさまざまな側面に集中できました。定期的な要求をこれらのエンドポイントに送信する独自の診断クライアントを記述して、応答を吸収します。この方法の詳細に説明してで、 [健康エンドポイント監視パターン](https://msdn.microsoft.com/library/dn589789.aspx) Microsoft の web サイト。

最大範囲は、お互いとの組み合わせでこれらのテクニックを使わなければなりません。

<a name="instrumenting-an-application"></a>
## アプリケーションのインストルメント化
計装、監視プロセスの重要な部分最初の場所でこれらの決定をすることを可能にするデータをキャプチャする場合、パフォーマンスとシステムの正常性について意味のある決定はできるのみです。インストルメンテーションを使用して収集する情報は、パフォーマンスを評価し、問題を診断トレースを実行するリモートの運用サーバーへのログインにあるかしなくても、意思決定を行うことができるように十分な (およびデバッグ) を手動でする必要があります。

インストルメンテーション データは通常、トレース ログ、およびメトリックに書き込まれた情報を構成します。

- The contents of a trace log can be the result of textual data written by the application, binary data created as the result of a trace event (if the application is using Event Tracing for Windows – ETW), or they can be generated from system logs that record events arising from parts of the infrastructure, such as a web server. Textual log messages are often designed to be human-readable, but they should also be written in a format that enables them to be easily parsed by an automated system. You should also categorize logs; don't write all trace data to a single log but use separate logs to record the trace output from different operational aspects of the system. This enables you to quickly filter log messages by reading from the appropriate log rather than having to process a single lengthy file. Never write information that has different security requirements (such as audit information and debugging data) to the same log.

	> [AZURE。メモ] ログは、ファイル システム上のファイルとして実装されるかもしれないまたは blob ストレージ内の blob などいくつかの他の形式で開催できます。ログ情報は、テーブル内の行より構造化されたストレージで開催されるかもしれない。

- メトリック一般的に単にメジャーまたはいくつかの側面またはリソースの数になりますシステム特定の時に 1 つまたは以上のタグまたはディメンションを関連付ける (とも呼ばれます、 _サンプル_).メトリックの 1 つのインスタンスは通常分離; で役に立ちません代わりに時間をかけて取得するメトリックがあります。考慮する重要な問題は、メトリクスを記録する必要がありますどのように頻繁。あまりにも頻繁メトリックス データを生成するはキャプチャ統計情報まれ可能性があります欠場する原因と重要なイベントにつながる状況に対しシステムの大幅な追加の負荷を課すことができます。考慮事項は、メトリックのメトリックに異なります。たとえば、サーバーの CPU 使用率は 2 番目、2 番目から大幅に異なる場合がありますが、人数分以上長い場合のみ問題となる使用率が高い。

<a name="information-for-correlating-data"></a>
### データの相関について
You can easily monitor individual system-level performance counters, capture metrics for resources, and obtain application trace information from various log files, but some forms of monitoring require the analysis and diagnostics stage in the monitoring pipeline to correlate the data retrieved from several sources. This data may take several forms in the raw data, and the analysis process must be provided with sufficient instrumentation data to be able to map these different forms. For example, at the application framework level, a task might be identified by a thread ID but within an application the same work might be associated with the user ID for the user performing that task. Furthermore, there is unlikely to be a 1:1 mapping between threads and user requests as asynchronous operations may reuse the same threads to perform operations on behalf of more than one user.  To complicate matters further, a single request may be handled by more than one thread as execution flows through the system. If possible, associate each request with a unique activity ID that is propagated through the system as part of the request context (the technique for generating and including activity IDs in trace information will be dependent on the technology being used to capture the trace data).

すべての監視データは、同じ方法でタイムスタンプする必要があります。一貫性を保つのためには、世界協定時刻を使用して、すべての日付と時刻を記録します。これは、イベントのトレース シーケンスより簡単にできるようにするに役立ちます。

> [AZURE。メモ] 異なるタイムゾーンとネットワークで動作しているコンピューターでの複数のマシンにわたる計測データの相関だけでタイムスタンプを使用して依存しないでくださいを同期できません可能性があります。

### インストルメンテーション データはどのような情報を含める必要がありますか。
インストルメンテーション データを収集する必要がありますを決定するときは、次の点を考慮してください。

- トレース イベントによって取り込まれた情報は、マシンと人間が読めるはずです。 この情報システム、ログ データの自動処理を容易にするための明確に定義されたスキーマを採用し、操作し、エンジニア リング スタッフ、ログの読み取りの一貫性を提供する必要があります。展開の環境は、プロセスを実行する、プロセス、およびコール スタックの詳細マシンなどの環境情報を含めます。  
- プロファイリング システムに大きなオーバーヘッドを課すことができるおよび必要な場合にのみ有効にする必要があります。インストルメンテーションを使用するプロファイリングと、(メソッドの呼び出し) などのイベントが選択されたイベントを記録サンプリングのみに対しに、それが発生するたびに記録されます。選択できる時間ベース-N 秒ごとに 1 回、または周波数に基づく-すべての n 個の要求したら。イベントが非常に頻繁に発生する場合インストルメンテーションによってプロファイリングも負担の多くを引き起こす可能性があり、全体的なパフォーマンスに影響を与えるそれ自身。この場合、サンプリング アプローチは望ましいかもしれません。ただし、イベントの頻度が低い場合、サンプリングがそれらを逃す可能性があります、この場合はインストルメンテーションより適切な方法があります。
- 各要求のソースを決定するには、開発者または管理者を有効にするための十分なコンテキストを提供します。これは、要求、および計算作業と使用リソースこのアクティビティを関連付けるために使用することができます情報の特定のインスタンスを識別するアクティビティ ID のいくつかのフォームを含めることができます。この作品がプロセスやマシンの境界を越える可能性がありますに注意してください。コンテキストを含める必要がありますまた、メータリング (直接または間接的他を介して情報を相関) 可能にする要求の原因となった顧客への参照。このコンテキストでは、監視データをキャプチャした時にアプリケーションの状態に関する貴重な情報を提供します。
- すべての要求や場所からこれらの要求が行われる領域を記録します。この情報は任意の場所に固有のホット スポットがあるかどうかを決定するを支援、アプリケーションまたはそれを使用してデータをパーティション分割するかどうかを決定する際に役立つことができるデータを提供できます。
- 記録し、慎重に例外の詳細をキャプチャします。多くの場合重要なデバッグ情報が悪い例外処理の結果として失われます。すべての内部例外と呼び出し履歴を可能な場合など、他のコンテキスト情報を含む、アプリケーションによってスローされた例外の完全な詳細情報をキャプチャします。
- Be consistent in the data that the different elements of your application capture as this can assist in analyzing events and correlating them with user requests. Consider utilizing a comprehensive and configurable logging package to gather information rather than depending on developers implementing different parts of the system all adopting the same approach. Gather data from key performance counters, such as the volume of I/O being performed, network utilization, number of requests, memory use, and CPU utilization. Some infrastructure services may provide their own specific performance counters, such as the number of connections to a database, the rate at which transactions are being performed, and the number of transactions that succeed or fail. Applications might also define their own specific performance counters.
- データベース システムなどの外部サービス、web サービス、またはインフラストラクチャ (たとえばキャッシュ Azure) の一部として提供されるその他のシステム レベルのサービスに対して行われたすべての呼び出しをログに記録します。各呼び出しの実行にかかった時間に関する情報を記録呼び出しの成否と。可能であれば、すべての再試行回数と発生する一時的なエラーの障害に関する情報をキャプチャします。

### テレメトリ システムとの互換性を確保します。
多くの場合、インストルメンテーションによって生成される情報は一連のイベントとして生成され、処理と解析のため独立したテレメトリ システムに渡されます。テレメトリ システムが通常、特定のアプリケーションまたはテクノロジの独立した通常、スキーマによって定義された特定の形式に従うこと情報を受け取る。スキーマは、効果的にデータ フィールドおよびテレメトリ システムを摂取することができる型を定義するコントラクトを指定します。スキーマは、様々 なプラットフォームやデバイスからデータを使用できるように一般化する必要があります。

共通のスキーマには、イベント名、イベントの時刻、送信者、およびその他のイベント (ユーザー ID、デバイス ID、アプリケーション ID など) に関連付けるために必要な詳細の IP アドレスなどのすべてのインストルメンテーション イベントに共通するフィールドを含める必要があります。スキーマをデバイスの種類に依存すべきではない、デバイスの任意の数でイベントが発生することに注意してください。異なるデバイスの数によって、同じアプリケーションのイベントが発生するさらに、アプリケーションは、デバイス間の分布の移動またはいくつかの他のフォームをサポート可能性があります。理想的にはこれらのフィールドの大半は、イベントをキャプチャするために使用するロギング ライブラリの出力にマップします。

スキーマでは、異なるアプリケーション間で一般的な特定のシナリオに関連するドメイン フィールドもあります。これは例外、アプリケーションの開始や終了イベントと web サービス API の呼び出しの成功または失敗に関する情報可能性があります。同じドメイン フィールドのセットを使用するすべてのアプリケーションは、一連の共通のレポートおよびビルドする analytics を有効にするイベントの同じセットを出力します。

最後に、スキーマは、アプリケーション固有のイベントの詳細をキャプチャするためのカスタム フィールドを含めることができます。

### アプリケーションを実装するためのベスト プラクティス
クラウドで実行されている分散アプリケーションをインストルメント化するためのベスト プラクティスを次に示します。

- 読むと簡単に解析するログを簡単にします。使用可能なログ構造化されました。簡潔になり、ログ ・ メッセージの説明。
- すべてのログで原因を特定し、各ログ レコードが書き込まれると、コンテキストとタイミング情報を提供します。
- すべてのタイムスタンプの同じタイムゾーンおよびフォーマットを使用します。これは、ハードウェアとサービスが異なる地理的地域にまたがる操作のイベントを関連付けるに役立ちます。
- ログを分類し、適切なログ ファイルにメッセージを書き込みます。
- システムに関する機密情報またはユーザーに関する個人情報を開示しません。それは記録される、前に、この情報をスクラブが、関連する詳細が保持されます。たとえば、ID とパスワード、データベース接続文字列から削除、システムが適切なデータベースにアクセスしているアナリストが判断できるように、残りの情報をログに書き込みます。すべての重要な例外が、例外と警告の下位レベルのログを有効または無効にする管理者を有効にします。また、キャプチャし、再試行ロジックのすべての情報をログに記録します。このデータは、システムの過渡状態を監視するのに役立ちます。
- アウト プロセスの呼び出し、外部 web サービスまたはデータベースへのリクエストなどをトレースします。
- 異なるセキュリティ要件が同じログ ファイルにログ メッセージを混在させないでください。たとえば、デバッグの書き込みしないし、情報を同じログを監査します。
- イベントの監査を除くすべてのログ呼び出しは業務の進行状況をブロックする必要があります火災を忘れて操作でなければなりません。監査イベントは、ビジネスに不可欠なビジネス運用の基本部分として分類することができますので例外です。
- ログは、拡張できる必要があります、ない具体的な目標に直接依存関係を持ちます。たとえばを使用して、情報を書くのではなく _System.Diagnostics.Trace_、(よう抽象インタ フェースを定義 _ILogger_) 公開ログ メソッドと任意の適切な手段を使用して実装できます。
- すべてのログは、フェール セーフである必要があり、カスケード エラーをトリガーする必要があることはありません。ログ記録は、例外をスローしないでください。
- 進行中の反復的なプロセスとして計装を扱うし、問題があるときにだけではなく、定期的にログを確認します。

## 収集およびデータを格納します。
The collection stage of the monitoring process is concerned with retrieving the information generated by instrumentation, formatting this data to make it easier to consume by the analysis/computation phase, and saving the transformed data in reliable and accessible storage. The instrumentation data that you gather from different parts of a distributed system could be held in a variety of locations and with varying formats. For example, your application code might generate trace log files, and generate application event log data, while performance counters that monitor key aspects of the infrastructure that your application uses could be captured by using other technologies.  Any third-party components and services that your application uses may provide instrumentation information in different formats, using separate trace files, blob storage, or even a custom data store.

データ収集はしばしばインストルメンテーション データを生成するアプリケーションから自律的に実行できるコレクション サービスを実装することによって実行されます。図 2 は、このアーキテクチャは、計測データ収集サブシステムを強調表示の例を示します。

![](media/best-practices-monitoring/TelemetryService.png)

_図 2。
計測データの収集_

これは簡易表示に注意してください。コレクション サービスは必ずしも単一のプロセスおよび次のセクションで説明するように別のマシンで実行されている多くの構成部品を含むことができます。さらに、すぐに実行する必要がありますいくつかのテレメトリ データの解析 (熱解析、セクションで説明したよう [熱い、暖かい、冷たい分析をサポート](#supporting-hot-warm-and-cold-analysis) 後述)、すぐにローカル コンポーネント コレクション サービス外営業分析タスクの実行可能性があります。図 2 は、選択したイベントのためこのような状況を示しています分析処理後の可視化と警告サブシステムに直接結果を送信できます。温かい、または冷たい解析データは、それが処理を待つ間、ストレージで開催されます。

Azure アプリケーションおよびサービスについては、Azure 診断 (かたまり) は、データのキャプチャに 1 つの可能な解決策を提供します。札束は、各計算ノードでは、次のソースからのデータが一緒にそれを集約し、Azure ストレージにアップロードして、収集します。

- 紺碧のログ
- IIS ログ
- IIS の失敗した要求のログ
- Windows イベント ログ
- パフォーマンス カウンター
- クラッシュ ダンプ
- Azure 診断インフラストラクチャのログ  
- カスタム エラー ログ

詳細については、記事を参照してください。 [Azure: 遠隔測定の基礎とトラブルシューティング](http://social.technet.microsoft.com/wiki/contents/articles/18146.windows-azure-telemetry-basics-and-troubleshooting.aspx) Microsoft の web サイト。

### インストルメンテーション データを収集するための戦略
クラウドと手動でシステム内のすべてのノードからテレメトリ データを取得する必要性を避けるために弾性の性質を考慮して、データを中央の場所に転送する必要があります手配し、連結。複数のデータ センターにまたがるシステム、それとで役立つ最初の収集、統合、および地域によって地域ごとにデータを格納する 1 つの中央システムに地域のデータを集計します。

帯域幅の使用を最適化するには、バッチ単位で緊急度の低いデータを転送することができます。ただし、データする必要がありますいないは延期する、時間-敏感な情報が含まれている場合は特に。

#### _引っ張り、インストルメンテーション データを押す_
計測データ収集サブシステムか積極的に計測器からデータを取得様々 なログと他のソース (アプリケーションのインスタンスごとに _プル モデル_)、または (、アプリケーションの各インスタンスを構成しているコンポーネントから送信されるデータを待っている受動的なレシーバーとして動作できます。 _プッシュ モデル_).

プル モデルを実装する方法の 1 つは、アプリケーションの各インスタンスにローカルに実行されている監視エージェントを使用することです。監視エージェントは、定期的に取得 (プル) テレメトリ データがローカル ノードで収集され、一元的なストレージ ・ アプリケーションのすべてのインスタンスで共有されるこの情報を直接書き込む別のプロセスです。これ札束によって実装されるメカニズムです。Azure の web またはワーカー ロールの各インスタンスは、診断キャプチャおよびローカルに格納されているその他のトレース情報を構成できます。Azure ストレージを指定したデータごとのコピーと一緒に実行される監視エージェント。ページ [Azure クラウド サービスと仮想マシンの構成診断](https://msdn.microsoft.com/library/azure/dn186185.aspx) Microsoft の web サイトにこのプロセスについての詳細を提供します。IIS ログなどの一部の要素では、クラッシュ ダンプとテーブル ストレージの blob ストレージは、Windows イベント ログ、ETW イベント、およびパフォーマンス カウンターのデータ中にログが書き込まれるカスタムのエラーが記録されます。図 3 は、このメカニズムを示しています。

![](media/best-practices-monitoring/PullModel.png)

_図 3。
監視エージェントを使用して情報を取得し、共有ストレージへの書き込み_

> [AZURE。メモ] 監視エージェントを使用して SQL Server 管理ビュー、または Azure サービス バス キューの長さからの情報など、データ ソースからプルは当然計測データのキャプチャに最適です。

構成して、Azure 診断を使用してについてを参照してください、 [Azure 診断を使用してログ データを収集します。](https://msdn.microsoft.com/library/azure/gg433048.aspx) Microsoft の web サイト上のページ。

ノード数の制限で動作する小規模アプリケーションのテレメトリ データは、ここで説明したアプローチを使用して 1 つの場所でうまく格納できます。ただし、複雑で拡張性の高い、グローバル クラウド アプリケーションは web ロールおよびワーカー ロール、データベースの破片、およびその他のサービスの数百から大量のデータを簡単に生成可能性があります。データのこの洪水は、中央の場所で使用可能な I/O 帯域幅を簡単に圧倒でした。したがってテレメトリ ソリューションはシステムの拡大、ボトルネックになってそれを防止し、システムの一部が失敗した場合 (監査や請求データ) など重要な監視情報が失われるリスクを軽減するための冗長性の程度を理想的に組み込むスケーラブルでなければなりません。

これらの問題に対処するためには、待ち行列を実装できます。図 4 は、この構造を示しています。このアーキテクチャ、ローカル監視エージェント (場合それを適切に構成することができます) またはカスタム データ コレクション サービス (ない場合) 投稿データをキュー、および非同期的に実行している別のプロセス (図 4 にストレージの書き込みサービス) でこのキューからデータを取り出し、それを共有ストレージに書き込みます。メッセージ キューは、少なくとも 1 回を投稿後、キューに置かれたデータがない失われることを確保するセマンティクスを提供します、このシナリオに適しています。ストレージの作成サービスは、個別のワーカー ロールを使用して実装できます。

![](media/best-practices-monitoring/BufferedQueue.png)

_図 4。
インストルメンテーション データをバッファーするキューを使用_

ローカル データ収集サービスは、すぐに受信キューにデータを追加できます。キューのバッファーとして機能し、ストレージ サービスの記述を取得したり、独自のペースでデータを書き込みます。既定では、キューは先入れ先出しごとに動作しますが、メッセージ キューをより迅速に行う必要があるデータが含まれている場合それらを加速する優先順位を設定することができます。詳細についてを参照してください、 [優先度キュー](https://msdn.microsoft.com/library/dn589794.aspx) パターン。また、必要な解析処理の形式に応じて異なる目的地へ直接データを (サービス バスのトピック) などの異なるチャネルを使用できます。

スケーラビリティは、サービスを書くストレージの複数のインスタンスを実行できます。大量のイベントがある場合、データ処理とストレージのための別のコンピューティング リソースを派遣するイベント ハブを使用できます。

<a name="consolidating-instrumentation-data"></a>
#### _計測データを統合します。_
The instrumentation data retrieved by the data collection service from a single instance of an application gives a localized view of the health and performance of that instance. To assess the overall health of the system, it is necessary to consolidate some aspects of the data in the local views together. This can be performed after the data has been stored, but in some cases it could also be achieved as the data is collected. Rather than being written directly to shared storage, the instrumentation data could pass through a separate data consolidation service which combines data and acts as a filter and cleanup process. For example, instrumentation data that includes the same correlation information such as an activity ID can be amalgamated (it is possible that a user starts performing a business operation on one node, and then gets transferred to another node in the event of node failure or depending on how load-balancing is configured). This process can also detect and remove any duplicated data (always a possibility if the telemetry service uses message queues to push instrumentation data out to storage). Figure 5 illustrates an example of this structure.

![](media/best-practices-monitoring/Consolidation.png)

_図 5。
別のサービスを使用して統合、インストルメンテーション データをクリーンアップするには_

### 計測データの保存
The previous discussions have depicted a rather simplistic view of the way in which instrumentation data is stored. In reality, it can make sense to store the different types of information by using technologies that are most appropriate to the way in which each type is likely to be used. For example, Azure blob and table storage have some similarities in the way in which they are accessed, but have limitations concerning the operations that you can perform using them and the granularity of the data that they hold is quite different. If you need to perform more analytical operations or require full-text search capabilities on the data, it may be more appropriate to use data storage that provides capabilities that are optimized for specific types of queries and data access. For example, performance counter data could be stored in a SQL database to enable ad-hoc analysis; trace logs might be better stored in Azure DocumentDB; security information could be written to HDFS; information requiring full-text search could be stored by using Elastic Search (which can also speed searches by using rich indexing.) You can implement an additional service that periodically retrieves the data from shared storage, partitions and filters the data according to its purpose, and then writes it to an appropriate set of data stores as shown in Figure 6. An alternative approach is to include this functionality in the consolidation and cleanup process and write the data directly to these stores as it is retrieved rather than saving it in an intermediate shared storage area. Each approach has its advantages and disadvantages. Implementing a separate partitioning service lessens the load on the consolidation and cleanup service, and enables at least some of the partitioned data to be regenerated if necessary (depending on how much data is retained in shared storage). However, it consumes additional resources, and there may be a delay between the instrumentation data being received from each application instance and this data being converted into actionable information.

![](media/best-practices-monitoring/DataStorage.png)

_図 6。
パーティションのデータ分析によると、ストレージの要件_

同じインストルメンテーション データは、1 つ以上の目的のために要求されるかもしれない。たとえば、パフォーマンス カウンターは、時間をかけて、システム パフォーマンスの歴史的概観を提供するために使用できますが、この情報がお客様の課金情報を生成するその他の使用状況データと組み合わせることも。これらの状況で同じデータを課金情報を保持するため長期的なストアと複雑なパフォーマンス分析を処理するための多次元ストアとして機能できるドキュメント データベースなどの 1 つ以上の宛先に送信できます。

また、どのように緊急必要があるデータを検討してください。データを迅速にアクセスする必要がありますを警告するための情報を提供し、そうで開催される必要がありますデータ記憶域を高速インデックスや警告システムが実行するクエリを最適化する構造します。いくつかのケースでは、書式設定し、データをローカル コンピューターに保存して、警告システムのローカル インスタンスすぐにすべての問題の通知できますので各ノードでデータを集めるテレメトリー サービスの必要があります。同じデータは、前の図に示すように、それがまた他の目的のため必要な場合を一元的にサービスを書くストレージにディスパッチできます。

多くのために使用される情報分析検討した、レポート、スポッティングの動向については、緊急度の低い、データ マイニングとアドホック クエリをサポートする方法で保存することができます。詳細については、のセクションを参照してください。 [熱い、暖かい、冷たい分析をサポート](#supporting-hot-warm-and-cold-analysis) 後で述べる。

#### _ログのローテーションとデータ保持_
Instrumentation can generate considerable volumes of data. This data can be held in several places, starting with the raw log files, trace files, and other information captured at each node to the consolidated, cleaned, and partitioned view of this data held in shared storage. In some cases, once the data has been processed and transferred the original raw source data can be removed from each node. In other cases, it may be necessary or simply useful to save the raw information. For example, data generated for debugging purposes may be best left available in its raw form but can then be discarded quite quickly once any bugs have been rectified. Performance data often has a longer life to enable it to be used to spot performance trends and for capacity planning. The consolidated view of this data is usually kept on-line for a finite period to enable fast access, after which it might be archived or discarded. Data gathered for metering and billing customers may need to be saved indefinitely. Additionally, regulatory requirements might dictate that information collected for auditing and security purposes will also need to be archived and saved. This data is also sensitive and may need to be encrypted or otherwise protected to prevent tampering. You should never record information such as users' passwords or other information that could be used to commit identity fraud; such details should be scrubbed from the data before it is stored.

#### _ダウン サンプリング_
頻繁に長期的な傾向を分析することができる履歴データを格納すると便利です。そっくりそのままで古いデータを保存するのではなくダウン サンプル データの解像度を削減し、ストレージ コストを節約することがあります。例としてよりもむしろ分ごとの業績評価指標、保存データ 1 ヶ月以上古い統合した時間単位で時間のビューを形成します。

### 収集し、ログ情報を格納するためのベスト プラクティス
キャプチャし、ログ情報を格納するためのベスト プラクティスを次に示します。

- 監視エージェントやデータ収集サービスのプロセス外サービスとして実行する必要があります展開する単純なする必要があります。
- すべての監視エージェントから出力またはデータ収集サービスは、コンピューター、オペレーティング システム、またはネットワーク プロトコルに依存しない柔軟なフォーマットをする必要があります。たとえば、ETL/ETW ではなく、JSON、MessagePack、または Protobuf などの自己記述形式で情報を出力します。標準フォーマットを使用すると、処理のパイプラインを構築します。読み取り、変換、および合意された形式でデータを出力するコンポーネントと簡単に統合できます。
- 監視とデータ収集のプロセスは、フェイル セーフである必要があり、カスケード エラー条件をトリガーする必要があります。
- 一時的な障害監視エージェントまたはデータ収集サービス データ シンクに情報を送信しながら最新の情報が最初に送信されるようにテレメトリ データの順序を変更する準備があります (監視エージェント/データ収集サービスは古いデータをドロップまたはローカルに保存し、独自の裁量で、追いつくに後でそれを送信場合もあります)。

## データを分析し、問題を診断します。
監視と診断のプロセスの重要な部分はシステムの全面的な福利の画像を取得する収集したデータを分析します。Kpi とパフォーマンス メトリックを定義する必要があり、分析の要件を満たすために収集されているデータを構成する方法を理解することが重要です。また、データ別のメトリックにキャプチャ ログ ファイルが関連付けられて、この情報は、イベントのシーケンスを追跡するキー、発生する問題の診断に役立つ方法を理解することが重要です。

セクションで説明されているよう [計測データを統合します。](#consolidating-instrumentation-data), the data for each part of the system is typically captured locally, but generally needs to be combined with data generated at other sites that participate in the system. This information requires careful correlation to ensure that data is combined accurately. For example, the usage data for an operation may span a node hosting a web site to which a user connects, a node running a separate service accessed as part of this operation, and data storage held on a further node. This information needs to be tied together to provide an overall view of the resource and processing usage for the operation. Some pre-processing and filtering of data might occur on the node on which the data is captured, while aggregation and formatting is more likely to occur on a central node.

<a name="supporting-hot-warm-and-cold-analysis"></a>
### 熱い、暖かい、冷たい分析をサポート
分析と可視化のためのデータを再フォーマット、レポート作成、および警告の目的は、リソースのセットを消費する複雑なプロセスをすることができます。監視のいくつかのフォーム タイム クリティカル効果を発揮するデータの即時解析を必要とされます。これと呼びます _ホットの分析_.アラートと監視システム (システムへの攻撃を検出) などのいくつかの側面に必要な解析があります。これらの目的のために必要なデータはすぐに利用可能な効率的な処理構造化する必要があります。それいくつかのケース分析データが保持されている個別のノードに処理を移動が必要になる場合があります。

分析の他の形態は、時間重要度の低い、raw データが受信された後、いくつかの計算や集計を必要があります。これと呼びます _暖かい解析_.パフォーマンス分析は多くの場合このカテゴリに分類します。この場合、一連のイベントのデータする必要がありますシステムのパフォーマンスのより信頼性の高い画像を提供するのに対し、分離、1 つのパフォーマンス イベントです (それがによって引き起こされる突然のスパイクやグリッチ)、統計的に有意な可能性が高い。温かみのある分析は、健康上の問題を診断するためにも使用できます。健康イベント ホット解析を実行することによって処理は通常、すぐにアラートを上げることができます。オペレーターは温かみのあるパスからデータを調べて健康イベントの理由にドリルダウンすることができるはずこのデータは、健康イベントの原因となった問題に至るまでのイベントに関する情報を含める必要があります。

監視のいくつかの種類を生成より長期的なデータと分析は定義済みのスケジュールに従っておそらく後日、実行します。場合によっては、分析期間にわたってキャプチャ データの大量の複雑なフィルターを実行する必要があります。これと呼びます _寒さの分析_.重要な要件は、それを取り込んだ後に、データを安全に保存、です。たとえば、利用状況の監視と監査に必要には、定期的なポイントでシステムの状態を正確に把握、収集されているすぐに処理できるようにこの状態情報はありません。 寒さの分析は、予測の健康分析データを提供するためにも利用できます。健康上の問題を引き起こす可能性がありますすぐにトレンド (ホット パスから取得した) 現在の健康データを指定した期間にわたって収集された歴史的情報は組み合わせて使用できます。これらのケースでは、撮影するための是正処置を有効にするアラートを生成する必要があります。

### データの相関
The data captured by instrumentation can provide a snapshot of the system state, but the purpose of analysis is to make this data actionable. For example, what has caused an intense I/O loading at the system level at a specific time? Is it the result of a large number of database operations? Is this reflected in the database response times, the number of transactions per second, and application response times at the same juncture? If so, then one remedial action that may reduce the load could be to shard the data over more servers. In addition, exceptions can arise as a result of a fault in any level of the system, and an exception in one level often triggers another fault in the level above. For these reasons you need to be able to correlate the different types of monitoring data at each level to produce an overall view of the state of the system and the applications that are executing on it. You can then use this information to make decisions about whether the system is functioning acceptably or not, and determine what can be done to improve the quality of the system.

セクションで説明されているよう [データの相関について](#information-for-correlating-data)、生インストルメンテーション データにイベントを関連付けるために必要な集計をサポートするための十分なコンテキストとアクティビティ ID 情報が含まれているを確認する必要があります。さらに、このデータは、さまざまな形式で開催されるかもしれないし、分析のために標準化された形式に変換するこの情報を解析する必要があります。

### トラブルシューティングおよび問題の診断
診断は、障害の根本原因の分析を実行するなど、予期しない動作の原因を決めることができる必要があります。通常必要な情報は次のとおりです。

- 指定された期間中にイベント ログやトレース システム全体または指定したサブシステムのいずれかから詳細情報を。
- 完全なスタック トレースは、例外と時間の指定された期間中に発生すること、システムまたは指定したサブシステム内で指定したレベルのエラーに起因します。
- 指定された時間ウィンドウの中に、障害が発生したプロセスのダンプをシステムの任意の場所または指定したサブシステムのクラッシュします。
- 活動記録時間の指定された期間中にすべてのユーザーまたは選択したユーザーのために実行中の操作を記録します。

トラブルシューティングの目的で多くのデータを分析するシステム アーキテクチャとソリューションを構成するさまざまなコンポーネントの深い技術的な理解が必要です。その結果、データを解釈し、問題の原因を確立、それらを修正する適切な戦略をお勧めします手作業の大部分よく必要があります。単にこの情報のコピーを元の形式で保存し、専門家によって寒さの分析のため利用できるように適切な場合があります。

## データを視覚化して警告の生成
どのモニタリング システムの重要な側面は、このような方法で任意の傾向や問題点、オペレーターが見つけることができますすぐに、すぐにオペレーター場合重要なイベントを通知するためが発生しました注意が必要なデータを表示する機能です。

データのプレゼンテーションは、ダッシュ ボードを使用して可視化を含む、いくつかの形式を取ることができるアラート、およびレポートします。

### ダッシュ ボードとビジュアル化
The most common way to visualize data is to use dashboards that can display information as a series of charts, graphs, or some other pictorial manner. These items could be parameterized, and an analyst should be able to select the important parameters (such as the time period) for any specific situation. Dashboards can be organized hierarchically, with top-level dashboards giving an overall view of each aspect of the system but with the facility to enable an operator to drill down to the details. For example, a dashboard that depicts the overall disk I/O for the system should allow an analyst to dig into the data and view the I/O rates for each individual disk to ascertain whether one or more specific devices account for a disproportionate volume of traffic. Ideally the dashboard should also display related information, such as the source of each request (the user or activity) that is generating this I/O. This information could then be used to determine whether (and how) to spread the load more evenly across devices, and whether the system would perform better if more devices were added. A dashboard might also be able to use color-coding or some other visual cues to indicate values that appear anomalous or that are outside an expected range. Using the previous example, a disk with an I/O rate approaching its maximum capacity over an extended period (a hot disk) could be highlighted in red, a disk with an I/O rate that periodically runs at its maximum limit over short periods (a warm disk) could be highlighted in yellow, and a disk exhibiting normal usage could be displayed in green.

効果的に動作するようにダッシュ ボード システムのため、それは作業に使用する生データする必要がありますに注意してください。独自のダッシュ ボード システムを構築する場合、別の組織が開発したダッシュ ボードを利用した粒度とそれが書式設定方法消費のためダッシュ ボードがどのようなレベルで収集する必要がありますどのインストルメンテーション データを理解する必要があります。

良いダッシュ ボードのみ情報は表示されません、それはアドホックな問いその情報にアナリストを許可する手段を提供します。いくつかのシステムでは、これらのタスクを実行し、基になるデータを探索するためにオペレーターが使用できる管理ツールを提供します。また、この情報を保持するために使用されるリポジトリによっては直接、このデータをクエリまたはさらに分析とレポートを Microsoft Excel などのツールにインポートすることがあります。

> [AZURE。メモ] 権限のある担当者にダッシュ ボードへのアクセスを制限する必要があります。この情報は、商業上微妙な可能性があります。また、それを変更するからユーザーを防ぐためにダッシュ ボードで表される基になるデータを保護する必要があります。

### 警告の生成
アラートは、監視および計測データを分析し、重要なイベントが検出された場合に通知を生成するプロセスです。

警告は、システムの健康、応答性、およびセキュリティで保護されたであることを確認する使用されます。ユーザーにパフォーマンス、可用性、およびプライバシーの保証を行うシステムの重要な部分であり、データがすぐに行動する必要があります。オペレーターは、警告をトリガーするイベントを通知する必要があります。警告は、自動スケーリングなどのシステム関数を呼び出す使用できます。

通常警告は次のインストルメンテーション データによって異なります。

- セキュリティ イベント。イベント ログが示している場合認証が繰り返し承認エラーが発生すると、システムは攻撃の下であるかもしれないおよびオペレーターを通知する必要があります。
- パフォーマンス メトリック。システムは、特定のパフォーマンス メトリックが指定されたしきい値を超えたかどうか迅速に対応する必要があります。
- 空き時間情報。障害を検出するには、1 つまたは複数のサブシステムまたはバックアップ リソースへのフェールオーバーを迅速に再起動する必要があります。 場合、サブシステムに繰り返し違反より深刻な懸念を可能性があります。

オペレーターが電子メール、ポケットベル デバイス、または SMS テキスト メッセージなど多くの配信チャネルを使用してアラート情報を受信します。アラートが生じている状況の重大度の表示もあります。多くの警告システム サポート サブスクライバー グループと同じグループのメンバーであるすべての演算子は、同じ一連の警告を送信できます。

An alerting system should be customizable and the appropriate values from the underlying instrumentation data could be provided as parameters. This approach enables an operator to filter data and focus on those thresholds or combinations of values which are of interest. Note that in some cases, the raw instrumentation data could be provided to the alerting system, while in other situations it might be more appropriate to supply aggregated data (for example, an alert could be triggered if the CPU utilization for a node exceeded 90% over the last 10 minutes). The details provided to the alerting system should also include any appropriate summary and context information; this data can help to reduce the possibility of false-positive events tripping an alert.

### レポート
報告システムの全体的なビューを生成するために使用、現在の情報と同様に、過去のデータを組み込むことができます。報告要件自体が 2 つの広範なカテゴリに分類: 運用レポートとセキュリティ レポートします。

オペレーション レポート通常次の側面が含まれます。

- 指定された時間ウィンドウの中にシステム全体または指定されたサブシステムのリソース使用率を理解することを可能にする統計情報を集約します。
- 一定の時間の間にシステム全体または指定されたサブシステムのリソース使用率の傾向を識別します。
- システム全体で発生したかで一定期間中にサブシステムを指定する例外を監視します。
- 人員配置の観点からアプリケーションの効率性を判断し、リソースのボリューム (および彼らのコスト) を不必要にパフォーマンスに影響を与えずに縮小できるかどうかを理解することです。

セキュリティ レポートは、お客様がシステムの使用状況の追跡にかかわって、含めることができます。

- ユーザー操作の監査日付と時刻と共にそれぞれのユーザーによって実行される個々 の要求の記録が必要です。データは、管理者が指定した期間に特定のユーザーによって実行される操作のシーケンスを迅速に再構築できるように構成する必要があります。
- ユーザーによるリソース使用状況を追跡各要求する方法ユーザー アクセス、システムを構成する様々 なリソースとどのように長い記録が必要です。管理者は、請求の目的のためにおそらく指定した期間にわたってユーザーが使用率レポートを生成するこのデータを使用できる必要があります。

多くの場合、定義済みのスケジュールに従ってバッチ処理によってレポートを生成する (待ち時間が通常問題) が、またに世代アドホック的に必要な場合に使用可能なはず。 Azure SQL データベースなどのリレーショナル データベースにデータを格納する場合、例として抽出してデータの書式を設定し、レポートのセットとして提示する SQL Server Reporting Services などツールを使用できます。

## 関連するパターンと指導
- 自動スケーリングのガイダンスでは、継続的にシステムのパフォーマンスを監視し、追加またはリソースを削除することについて決定を下すにオペレーターの必要性を減らすことによってオーバーヘッド管理の負担軽減について説明します。
- 、 [健康エンドポイント監視パターン](https://msdn.microsoft.com/library/dn589789.aspx) 外部ツールは、一定の間隔で公開されているエンドポイントを通じてアクセスできるアプリケーション内の機能のチェックを実装する方法について説明します。
- 、 [優先度キュー](https://msdn.microsoft.com/library/dn589794.aspx) パターンは、キュー内のメッセージの優先順位を決める、緊急要求が受信し、緊急度の低いメッセージの前に処理することができますを示しています。

## 詳細については
- 記事 [監視、診断、およびトラブルシューティング Microsoft Azure ストレージ](storage-monitoring-diagnosing-troubleshooting.md) Microsoft の web サイト。
- 記事 [Azure: 遠隔測定の基礎とトラブルシューティング](http://social.technet.microsoft.com/wiki/contents/articles/18146.windows-azure-telemetry-basics-and-troubleshooting.aspx) Microsoft の web サイト。
- ページ [Azure 診断を使用してログ データを収集します。](https://msdn.microsoft.com/library/azure/gg433048.aspx) Microsoft の web サイト。
- ページ [Azure クラウド サービスと仮想マシンの構成診断](https://msdn.microsoft.com/library/azure/dn186185.aspx) Microsoft の web サイト。
- 、 [紺碧 Redis キャッシュ](http://azure.microsoft.com/services/cache/), [紺碧の DocumentDB](http://azure.microsoft.com/services/documentdb/)、と [HDInsight](http://azure.microsoft.com/services/hdinsight/) Microsoft の web サイト上のページ。
- ページ [サービス バス キューを使用する方法](http://azure.microsoft.com/) Microsoft の web サイト。
- 記事 [Azure の仮想マシンで SQL Server ビジネス インテリジェンス](https://msdn.microsoft.com/library/azure/jj992719.aspx) Microsoft の web サイト。
- ページ [Azure でアラートおよび通知の監視について](https://msdn.microsoft.com/library/azure/dn306639.aspx) Microsoft の web サイト。
- 、 [アプリケーションのインサイト](app-insights-get-started/) Microsoft の web サイト上のページ。
